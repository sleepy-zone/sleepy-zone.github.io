<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://sleepy-zone.github.io/blog</id>
    <title>😴 Sleepy Zone Blog</title>
    <updated>2025-06-20T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://sleepy-zone.github.io/blog"/>
    <subtitle>😴 Sleepy Zone Blog</subtitle>
    <icon>https://sleepy-zone.github.io/img/logo.svg</icon>
    <entry>
        <title type="html"><![CDATA[为什么随着 AI 能力的提升，人类意图变得更加重要]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-06-20-why-human-intent-matters-more-as-ai-capabilities-grow.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-06-20-why-human-intent-matters-more-as-ai-capabilities-grow.md"/>
        <updated>2025-06-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[发烧两天，终于恢复，继续更新。]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img17@main/2025/06/19/1750328660936-1ea0145a-8060-45e6-8641-5e2879d98704.png" alt="" class="img_ev3q"></p>
<p>发烧两天，终于恢复，继续更新。</p>
<p>我发现 Cline 的官方博客真的是宝藏，虽然其实很多博客都是在宣传自身或者自身的一个 feature，但确实有很多很深刻又很有启发的观点，忍不住想分享给大家。比如今天这篇：<a href="https://cline.bot/blog/why-human-intent-matters-more-as-ai-capabilities-grow" target="_blank" rel="noopener noreferrer"><strong>为什么随着 AI 能力的提升，人类意图变得更加重要。</strong></a>配合前文<a href="https://mp.weixin.qq.com/s/pdznzYiS6oUT1epOuBLX3g" target="_blank" rel="noopener noreferrer">
Cline 源码浅析 - Prompt 设计
</a>食用更加。</p>
<hr>
<p>还记得当 AI 编码只是简单的自动补全吗？那时，人类完成了大部分工作：浏览代码库、寻找正确的文件、定位要编辑的位置、开始输入，然后 AI 才能提供一些建议。人类是主导者，而 AI 只是辅助。</p>
<p>如今的智能 AI 能够搜索代码库、读取文件、编写完整模块、重构系统，并在多个文件中进行复杂的变更。借助像 Cline 这样的工具，AI 几乎接管了整个编码过程。这就产生了一个有趣的问题：如果 AI 几乎能做所有事情，人类还能做什么？</p>
<p>答案其实很简单：<strong>意图</strong>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="最后一段路是最重要的">最后一段路是最重要的<a href="https://sleepy-zone.github.io/blog/2025-06-20-why-human-intent-matters-more-as-ai-capabilities-grow.md#%E6%9C%80%E5%90%8E%E4%B8%80%E6%AE%B5%E8%B7%AF%E6%98%AF%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84" class="hash-link" aria-label="最后一段路是最重要的的直接链接" title="最后一段路是最重要的的直接链接">​</a></h2>
<p>随着 AI 能力的增强，人类的角色并没有减少，而是发生了转变。当 AI 能够处理编码的细节时，我们需要思考：<em>我们在构建什么，以及为什么要构建它？</em></p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img5@main/2025/06/19/1750328832364-a318ee62-8982-441b-99b0-04f0d65594f3.png" alt="" class="img_ev3q"></p>
<p>可以将这过程视为一张工作量的饼图。在自动补全时代：</p>
<ul>
<li>人类工作量： 95%（导航、规划、输入、调试）</li>
<li>AI 工作量：5%（提供建议）</li>
</ul>
<p>在智能 AI 时代：</p>
<ul>
<li>AI 工作量：95%（搜索、阅读、写作、重构）</li>
<li>人类工作量：5%（意图）</li>
</ul>
<p>而这 5% 就是<strong>决定性因素</strong>。它决定了 AI 是完美地构建错误的东西，还是构建完全符合需求的东西。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="为什么我们创建了计划-行动模式">为什么我们创建了计划-行动模式<a href="https://sleepy-zone.github.io/blog/2025-06-20-why-human-intent-matters-more-as-ai-capabilities-grow.md#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E5%88%9B%E5%BB%BA%E4%BA%86%E8%AE%A1%E5%88%92-%E8%A1%8C%E5%8A%A8%E6%A8%A1%E5%BC%8F" class="hash-link" aria-label="为什么我们创建了计划-行动模式的直接链接" title="为什么我们创建了计划-行动模式的直接链接">​</a></h2>
<p>问题在于：AI 充满热情。一旦赋予它读写文件的工具，它就会立即开始编码。这就像一个才华横溢的开发者在完全理解需求之前就开始动手。</p>
<p>这种急切并不是缺陷，而是这些模型工作的特性。它们被设计为提供帮助、采取行动、解决问题。但如果没有明确的意图，行动可能会走偏。</p>
<p>计划-行动模式不是为了给 AI 设置不同的“模式”，而是为了认识到有效合作的自然阶段。在计划阶段，我们为相互理解创造了一个专门的空间。我们让 AI 尽可能地关注人类的意图。不是因为 AI 能力不足，而是因为意图是唯一无法自动化的东西。</p>
<p>接下来是行动阶段，我们将其放手。AI 的能力不变，但现在优化为不间断的执行。这是我们互动方式的模式转变，而不是性格的变化。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="反角色哲学-为何计划-行动不是模式">反角色哲学 (为何计划-行动不是“模式”)<a href="https://sleepy-zone.github.io/blog/2025-06-20-why-human-intent-matters-more-as-ai-capabilities-grow.md#%E5%8F%8D%E8%A7%92%E8%89%B2%E5%93%B2%E5%AD%A6-%E4%B8%BA%E4%BD%95%E8%AE%A1%E5%88%92-%E8%A1%8C%E5%8A%A8%E4%B8%8D%E6%98%AF%E6%A8%A1%E5%BC%8F" class="hash-link" aria-label="反角色哲学 (为何计划-行动不是“模式”)的直接链接" title="反角色哲学 (为何计划-行动不是“模式”)的直接链接">​</a></h2>
<p>你可能见过一些编码助手，拥有专门的“智能体”：比如调试器、架构师和代码审阅者。我们刻意避开这种方法，原因如下图：</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img3@main/2025/06/19/1750340787740-6044e41d-6a0e-4eee-871c-3d3cfadbf460.png" alt="我们设计 Cline 是为了展现模型的潜力，而不是按照我们的需求来操控它们。" class="img_ev3q"></p>
<blockquote>
<p>图中的英文翻译：第二个要从这个痛苦的教训中学到的要点是：心灵的实际内容是极其复杂的，无法挽回的；我们应该停止尝试找到简单的方法来思考心灵的内容，比如思考空间、物体、多个智能体或对称性的简单方法。所有这些都是任意的、本质上复杂的外界的一部分。由于它们的复杂性是无穷的，因此不应内置其中；相反，<strong>我们应该仅构建能够发现和捕捉这种任意复杂性的元方法。</strong></p>
</blockquote>
<p>Richard Sutton 在 AI 研究中的<a href="http://www.incompleteideas.net/IncIdeas/BitterLesson.html?ref=cline.ghost.io" target="_blank" rel="noopener noreferrer">“苦涩教训”</a>指出，利用计算的通用方法往往优于专业化的人工设计解决方案。当深蓝击败 Kasparov 时，它并没有使用大师级策略，而是依靠蛮力搜索。当 AlphaGo 征服围棋时，它并没有遵循古老的智慧，而是使用通用学习算法。</p>
<p>现代语言模型，例如 Claude Sonnet 4 和 Geminin 2.5 Pro，经过完整的编码过程训练，已经见识过数百万个架构决策、调试会话和代码审阅的案例。人工角色的创建会限制它们自然的能力。</p>
<p>这点很关键：<strong>计划和行动不是不同 AI 个性或能力的“模式”</strong>。我们没有在“计划 AI”和“编码 AI”之间切换。它始终是同一个 AI，能力不变。</p>
<p>变化的是交互模式。在计划阶段，我们优化意图收集；AI 会提问，探索上下文，确保理解。在行动阶段，我们优化执行；AI 不间断地发挥其全部能力。这是关于识别人类与 AI 合作的自然节奏，而不是限定 AI 的角色。</p>
<p>可以将其类比于对话与专注工作。你不会认为开发者在需求会议与编码时有不同的“模式”。他们是同一个人，只是在不同的工作阶段中。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="不要打扰-ai">不要打扰 AI<a href="https://sleepy-zone.github.io/blog/2025-06-20-why-human-intent-matters-more-as-ai-capabilities-grow.md#%E4%B8%8D%E8%A6%81%E6%89%93%E6%89%B0-ai" class="hash-link" aria-label="不要打扰 AI的直接链接" title="不要打扰 AI的直接链接">​</a></h2>
<p>我们发现一个有趣的现象：大语言模型是出色的<a href="https://x.com/cline/status/19107658728280802930?ref=cline.ghost.io" target="_blank" rel="noopener noreferrer">叙述者</a>。它们是为构建连贯故事而设计的预测文本引擎：先发生这个，然后是那个，再然后是另一个。</p>
<p>如果你在 AI 执行任务时中途打断它来纠正方向，就会破坏这种叙述的流畅性。模型需要调整你的干预与之前的路径，通常会导致混乱或不理想的结果。</p>
<p>斯坦福大学的<a href="https://cs.stanford.edu/~nfliu/papers/lost-in-the-middle.arxiv2023.pdf?ref=cline.ghost.io" target="_blank" rel="noopener noreferrer">“迷失在中间”</a>研究 (Liu et al., 2023) 表明，当处理被打断的上下文时，大语言模型的性能会显著下降。研究发现，当相关信息出现在长上下文的中间而不是开始时，模型的准确率下降了近 20%。重新开始，虽然看似低效，但通常效果更好，因为模型能够从清晰的意图构建完整的叙述，而不需要在受损的中间上下文信息中挣扎。</p>
<p>这就是为什么重新开始并提供更清晰的指令通常比纠正方向更有效。保存当前状态，让 AI 继续工作，然后接受结果或者重新开始，而不是纠结于修正。</p>
<p>随着推理成本下降，我们甚至可以同时进行多次尝试，并选择最佳结果，就像拉动老虎机一样，每次拉杆的成功概率都是独立的。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="让-ai-自主运作">让 AI 自主运作<a href="https://sleepy-zone.github.io/blog/2025-06-20-why-human-intent-matters-more-as-ai-capabilities-grow.md#%E8%AE%A9-ai-%E8%87%AA%E4%B8%BB%E8%BF%90%E4%BD%9C" class="hash-link" aria-label="让 AI 自主运作的直接链接" title="让 AI 自主运作的直接链接">​</a></h2>
<p>在计划阶段确定了你的意图后，接下来的原则同样重要：让 AI 自由发挥。</p>
<p>这与我们的反角色哲学直接相关。我们不将 AI 限制为“调试器”或“架构师”等特定角色，同样，我们也不会在执行过程中限制它。行动阶段的重点是让模型充分发挥其所有能力：架构决策、调试、重构、优化，作为一个整体智能体。</p>
<p>我们注意到，最新的 Claude 4 模型在自动批准模式下表现优异。每次中断都会打断其叙述流程。最有效的情况是 AI 能够不受干扰地进行写作。</p>
<blockquote>
<p>需要注意的是，模型的最佳表现来自不受干扰的构建。然而，结果可能并不总是与你的意图完全一致。因此，如果你从事复杂的工程工作，我们建议你仍然保持参与，更重要的是，详细制定你的计划。</p>
</blockquote>
<p>这可能看起来有些违反直觉。难道我们不需要控制、监督和干预的能力吗？</p>
<p>是的，但不需要实时进行。这就是我们构建以下功能的原因：</p>
<ul>
<li>检查点（Checkpoints）：保存状态，随时可以返回。</li>
<li>全面可见性（Full visibility）：了解 AI 的全部操作。</li>
<li>撤销功能（Undo capabilities）：撤销任何更改。</li>
<li>安全边界（Safety boundaries）：定义 AI 能触及和不能触及的范围。</li>
</ul>
<p>关键在于时机。先收集需求，共享意图，设定边界，然后让 AI 工作。之后再进行审查和迭代，而不是实时进行。</p>
<hr>
<p>编码的未来不在于人类与 AI 竞争或通过不断细化专业领域来保持重要性。而在于人类发挥独特的作用：提供意图、意义和目标，而由 AI 来执行具体操作。</p>
<p>这不仅不是一个减弱的角色，而是所有角色中最为重要的。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="Cline" term="Cline"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[什么是 Coding Agent?]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-06-16-what-makes-a-coding-agent.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-06-16-what-makes-a-coding-agent.md"/>
        <updated>2025-06-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[本文翻译自 Cline 博客 What Makes a Coding Agent?。]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img13@main/2025/06/13/1749821751724-de0cc087-4ad2-40a5-bd9e-d9918cae3ea9.png" alt="" class="img_ev3q"></p>
<p>本文翻译自 Cline 博客 <a href="https://cline.bot/blog/what-makes-a-coding-agent" target="_blank" rel="noopener noreferrer">What Makes a Coding Agent?</a>。</p>
<p>在我写完<a href="https://mp.weixin.qq.com/s/9bJAeQ3U0_U85sDCcJSXxw" target="_blank" rel="noopener noreferrer">Cline 源码浅析 - 从输入到输出</a>后，我就看到了这篇博客，整个博客的内容和我结尾的观点不谋而合。</p>
<hr>
<p>当开发者首次接触到 Cline 时，他们常常称之为自己的“通用人工智能 (AGI) 时刻”——那一瞬间，他们意识到 AI 已经从一个简单的建议工具发展成为真正的编码伙伴。那么，究竟是什么让一个真正的编码 AI 智能体与众多 AI 驱动的开发工具有所不同呢？答案在于理解“智能体”这个词的确切含义。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="agent-定义">Agent 定义<a href="https://sleepy-zone.github.io/blog/2025-06-16-what-makes-a-coding-agent.md#agent-%E5%AE%9A%E4%B9%89" class="hash-link" aria-label="Agent 定义的直接链接" title="Agent 定义的直接链接">​</a></h3>
<p>OpenAI 将智能体定义为“一个能够独立为你完成任务的系统”。Anthropic 则更进一步，描述智能体为“一个系统，其中的大语言模型 (LLM) 能够动态地指挥自身的流程和工具使用，掌控任务的完成方式”。虽然各家公司可能在细节上有所不同，但在基本架构上达成了共识：智能体由三个重要部分组成：<strong>(1) 模型，(2) 工具，和 (3) 指令</strong>。</p>
<p>这种区别比你想象的更为重要。以 ChatGPT 为例。虽然 ChatGPT 技术先进，但它并不是真正的 AI 智能体；它是为聊天应用精心调整的模型。它可以根据你的提示进行回应，但无法独立组织复杂的工作流程或自主决定如何完成多步骤任务。</p>
<p>相比之下，Cline 被构建为一个真正的 AI 智能体，因为它通过三个重要的组成部分自主生成代码。接下来，我们来探讨每个组件的工作原理，以及为什么这种架构能够实现本质上不同的能力。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="自主编码��的三大基础">自主编码的三大基础<a href="https://sleepy-zone.github.io/blog/2025-06-16-what-makes-a-coding-agent.md#%E8%87%AA%E4%B8%BB%E7%BC%96%E7%A0%81%E7%9A%84%E4%B8%89%E5%A4%A7%E5%9F%BA%E7%A1%80" class="hash-link" aria-label="自主编码的三大基础的直接链接" title="自主编码的三大基础的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-模型大脑">1. 模型：大脑<a href="https://sleepy-zone.github.io/blog/2025-06-16-what-makes-a-coding-agent.md#1-%E6%A8%A1%E5%9E%8B%E5%A4%A7%E8%84%91" class="hash-link" aria-label="1. 模型：大脑的直接链接" title="1. 模型：大脑的直接链接">​</a></h4>
<p><strong>模型</strong>是智能体的核心决策者，可以说是“大脑”。当你配置 Cline 时，其实是在选择哪个 AI 模型来驱动你的编码伙伴。Cline 支持多个提供商，包括 Anthropic、OpenAI 和 Google，并提供具体的模型，比如 Claude 3.5 Sonnet、GPT-4.1 或 Gemini 2.5 Pro。</p>
<p>这种不依赖特定模型的方法不仅仅是关于选择，更是关于赋予使用者更多的能力。许多竞争对手会将你锁定在特定模型上，或者施加限制来保护他们的推理利润，而 Cline 则让你可以完全使用所选模型的全部功能。无论你需要强大的前沿模型来进行复杂的架构决策，还是选择像 DeepSeek-V3-0324 这样的经济型模型来完成日常任务，Cline 都为你提供了无障碍的途径。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-工具双手">2. 工具：双手<a href="https://sleepy-zone.github.io/blog/2025-06-16-what-makes-a-coding-agent.md#2-%E5%B7%A5%E5%85%B7%E5%8F%8C%E6%89%8B" class="hash-link" aria-label="2. 工具：双手的直接链接" title="2. 工具：双手的直接链接">​</a></h4>
<p><strong>工具</strong>是 AI 智能体执行任务时使用的外部功能，可以把它们理解为动词，比如“搜索”、“编辑”和“阅读”。Cline 提供了一个全面的工具包，其中包括文件操作、终端命令、浏览器自动化，以及通过模型上下文协议 (MCP) 与外部服务的整合。</p>
<p>这是自主性的重要体现。传统软件通常按照预设的操作步骤执行，而 Cline 的智能体架构则让模型自主决定使用哪些工具以及使用的时机。面对复杂的编码任务，Cline 可以自主选择是先探索代码库、阅读文档、运行测试，还是直接开始实现。这种动态决策过程就是人们所说的智能体“自主性”的真正含义。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-指令指引">3. 指令：指引<a href="https://sleepy-zone.github.io/blog/2025-06-16-what-makes-a-coding-agent.md#3-%E6%8C%87%E4%BB%A4%E6%8C%87%E5%BC%95" class="hash-link" aria-label="3. 指令：指引的直接链接" title="3. 指令：指引的直接链接">​</a></h4>
<p>第三个重要组成部分是<strong>明确的准则</strong>，它们定义了智能体的行为方式。Cline 通过精心设计的指令和系统提示，来确定其如何解决问题、与代码库进行交互以及保持编码标准。</p>
<p>这些指令不仅仅是简单的聊天回复。它们包含了复杂的推理模式、错误处理策略和协作工作流程，这使得 Cline 能够真正成为你的编码伙伴。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="递归执行引擎">递归执行引擎<a href="https://sleepy-zone.github.io/blog/2025-06-16-what-makes-a-coding-agent.md#%E9%80%92%E5%BD%92%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E" class="hash-link" aria-label="递归执行引擎的直接链接" title="递归执行引擎的直接链接">​</a></h3>
<p>理解这些组成部分只是开始。真正的强大之处在于它们如何通过递归执行协同工作。当你发送一个提示给 Cline 时，系统背后会发生一些奇妙的事情。</p>
<p>Cline 首先会根据你的工作空间、计算机环境和你提供的自定义指令来扩展其系统提示。这个增强后的提示，连同你整个对话历史，被传送到所选的模型中。接下来就是智能体的协调过程。
Cline 会自主地在递归循环中调用工具；它会不断调用自己，直到确定任务完成。模型会自行决定做什么、使用哪些工具，以及何时完成编码。</p>
<p>我们来看一个具体的例子。假设你告诉 Cline“在主页上添加一个新按钮。”接下来会发生以下事情：</p>
<p>步骤 1: 探索 模型可能首先调用 list_files 工具，以了解你的代码库结构。Cline 发送请求后，会收到一个目录列表。</p>
<p>步骤 2: 调查 拥有文件结构后，Cline 可能会递归地调用 read_file 工具，检查 homepage.tsx 文件，理解当前的实现，并确定在哪里添加按钮。</p>
<p>步骤 3: 实施 在掌握上下文后，Cline 调用 write_to_file 工具，生成所需的代码更改，添加具有适当样式和功能的按钮。</p>
<p>步骤 4: 完成 完成更改并确认没有错误后，Cline 调用 attempt_completion 工具，结束递归循环。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img14@main/2025/06/15/1749993685310-41a499e0-d393-45b7-8241-f794985a1082.png" alt="" class="img_ev3q"></p>
<p>在实际应用中，Cline 常常进行比这个简化示例更多的递归循环。关键在于，每个决策（例如使用什么工具、如何解释结果、何时停止）都由模型根据当前的上下文和对任务的理解自主做出。</p>
<p>Cline 的开源透明性增加了一个重要的维度。不同于那些将决策过程隐藏的“黑箱”工具，Cline 提供了实时的透明度，可以查看每个文件的读取、每个工具的调用和每个决策。这种透明性不仅仅关乎信任，更关乎在人类对日益复杂的自动化进行监督和控制。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="Cline" term="Cline"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Cline 源码浅析 - Prompt 设计]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md"/>
        <updated>2025-06-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[“Agent 就是如何拼出更好用的 Prompt”，虽然有点玩笑的意味，但也能说明一定的问题。本篇文章我们探讨下 Cline 里的 Prompt 设计。]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img17@main/2025/06/06/1749176746221-f97aba25-6da5-461a-be21-369de1c44fff.png" alt="" class="img_ev3q"></p>
<p>“Agent 就是如何拼出更好用的 Prompt”，虽然有点玩笑的意味，但也能说明一定的问题。本篇文章我们探讨下 Cline 里的 Prompt 设计。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-prompt">System Prompt<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#system-prompt" class="hash-link" aria-label="System Prompt的直接链接" title="System Prompt的直接链接">​</a></h2>
<p>众所周知，System Prompt 是 Agent 的核心资产😂，Github 上 <a href="https://github.com/x1xhlol/system-prompts-and-models-of-ai-tools" target="_blank" rel="noopener noreferrer">system-prompts-and-models-of-ai-tools</a> 这个仓库收集了各类 AI 应用的 System Prompt，已经有 56.6K 的 Star 了，可见一斑。</p>
<p>Cline 的 System Prompt 位于 <code>src/core/prompts/system.ts</code>，根据上下文信息、工具以及模型信息动态生成。</p>
<blockquote>
<p>You are Cline, a highly skilled software engineer with extensive knowledge in many programming languages, frameworks, design patterns, and best practices.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="工具-tool-use">工具 TOOL USE<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#%E5%B7%A5%E5%85%B7-tool-use" class="hash-link" aria-label="工具 TOOL USE的直接链接" title="工具 TOOL USE的直接链接">​</a></h3>
<blockquote>
<p>You have access to a set of tools that are executed upon the user's approval. You can use one tool per message, and will receive the result of that tool use in the user's response. You use tools step-by-step to accomplish a given task, with each tool use informed by the result of the previous tool use.</p>
</blockquote>
<p>我们自上而下的读一遍 System Prompt。</p>
<ol>
<li>工具调用格式</li>
</ol>
<p>首先告诉模型使用 XML 语法输出工具调用相关的内容。</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">tool_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parameter1_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">value1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parameter1_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parameter2_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">value2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parameter2_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">tool_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>工具列表</li>
</ol>
<p>列举了 Cline 内置的工具，主要包括描述、参数以及使用 DEMO，比如 <code>write_to_file</code>：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> write_to_file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description: Request to write content to a file at the specified path. If the file exists, it will be overwritten with the provided content. If the file doesn't exist, it will be created. This tool will automatically create any directories needed to write the file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> path: (required) The path of the file to write to (relative to the current working directory ${cwd.toPosix()})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> content: (required) The content to write to the file. ALWAYS provide the COMPLETE intended content of the file, without any truncation or omissions. You MUST include ALL parts of the file, even if they haven't been modified.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Usage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">write_to_file</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">path</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">File path here</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">path</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">content</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your file content here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">content</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">write_to_file</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Cline 内置了十多个工具，覆盖了命令行、文件操作、浏览器、MCP 等，这些工具极大的丰富了模型的能力。</p>
<ol start="3">
<li>工具调用 Example</li>
</ol>
<p>展示了多个工具调用的样例给模型参考：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Tool Use Examples</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Example 1: Requesting to execute a command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">execute_command</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">command</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">npm run dev</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">command</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">requires_approval</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">false</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">requires_approval</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">execute_command</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制��代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>工具使用指引</li>
</ol>
<p>这里相当于手把手教模型逐步思考如何使用工具（类似于思维链（CoT）），简单翻译如下：
1）首先，模型需要评估已经掌握的信息，使用 <code>&lt;thinking&gt;</code> 标签包裹。
2）根据任务和提供的工具描述，选择最合适的工具。
3）如果需要执行多个操作，请一次只使用一个工具，每一步都必须以前一步的结果为依据。
4）使用指定的 XML 格式来构建你的工具调用。
5）每次使用工具后，用户将回复该工具的执行结果。这个结果会为你提供继续任务或做出进一步决策所需的信息。
6）每次使用工具后，一定要等待用户的确认后再继续。</p>
<p>以上的操作，可以确保模型按步骤拆解任务，确认每步的成功与否，根据用户的反馈实时进行调整，保证工具使用和最终任务的正确性。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mcp-server">MCP Server<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#mcp-server" class="hash-link" aria-label="MCP Server的直接链接" title="MCP Server的直接链接">​</a></h3>
<p>这部分我们在 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDA0MTE5Mw==&amp;mid=2247483942&amp;idx=1&amp;sn=70ad8830317f688b79d800c39b80a62d&amp;chksm=9b572020ac20a936dcd5606ed29690f3c2d4856b39a0e9193c52f64896d47e4bd064e9e4fc7d&amp;scene=178&amp;cur_album_id=4021745110793502724&amp;search_click_id=#rd" target="_blank" rel="noopener noreferrer">Cline 源码浅析 - MCP 调用</a>聊过，这里不再展开。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="文件编辑-editing-files">文件编辑 EDITING FILES<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#%E6%96%87%E4%BB%B6%E7%BC%96%E8%BE%91-editing-files" class="hash-link" aria-label="文件编辑 EDITING FILES的直接链接" title="文件编辑 EDITING FILES的直接链接">​</a></h3>
<p>对于 Code Agent 文件编辑是非常重要的部分，这里再次强调了 <code>write_to_file</code> 和 <code>replace_in_file</code> 两个工具的使用：详细的使用时机以及重要提示。</p>
<p>再次以 workflow 的方式告诉模型使用文件编辑工具的最佳实践：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> 在进行编辑之前，评估你更改的范围，并决定使用哪个工具。  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> 对于有针对性的修改，请使用 </span><span class="token code-snippet code keyword" style="color:#00009f">`replace_in_file`</span><span class="token plain"> 工具，并精心编写 SEARCH/REPLACE 块。如果你需要进行多项更改，可以在一个 </span><span class="token code-snippet code keyword" style="color:#00009f">`replace_in_file`</span><span class="token plain"> 调用中堆叠多个 SEARCH/REPLACE 块。  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">3.</span><span class="token plain"> 对于大规模重构或初始文件创建，请依赖 </span><span class="token code-snippet code keyword" style="color:#00009f">`write_to_file`</span><span class="token plain"> 工具。  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">4.</span><span class="token plain"> 一旦文件通过 </span><span class="token code-snippet code keyword" style="color:#00009f">`write_to_file`</span><span class="token plain"> 或 </span><span class="token code-snippet code keyword" style="color:#00009f">`replace_in_file`</span><span class="token plain"> 被编辑，系统将向你提供修改后文件的最终状态。请将此更新后的内容作为后续所有 SEARCH/REPLACE 操作的参考点，因为它反映了任何自动格式化或用户手动应用的更改。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">通过在 </span><span class="token code-snippet code keyword" style="color:#00009f">`write_to_file`</span><span class="token plain"> 和 </span><span class="token code-snippet code keyword" style="color:#00009f">`replace_in_file`</span><span class="token plain"> 之间做出深思熟虑的选择，你可以使文件编辑过程更加顺畅、安全和高效。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="act-mode-和-plan-mode">Act Mode 和 Plan Mode<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#act-mode-%E5%92%8C-plan-mode" class="hash-link" aria-label="Act Mode 和 Plan Mode的直接链接" title="Act Mode 和 Plan Mode的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img17@main/2025/06/11/1749631375428-9af1e1b3-f2d1-44bd-991e-c15f14b7cf96.png" alt="" class="img_ev3q"></p>
<p>Cline 提供了两种模式：Plan 和 Act。对于复杂任务，Cline 推荐从 Plan 模式开始，让模型先行规划策略，然后切换到 Act 模式，按照规划逐步实施，以提高代码输出质量。对话过程中，可以在两个模式中切换，就像人一样，写代码过程中，遇到问题，停下来思考。</p>
<p>System Prompt 里详细描述了两种模式的差异，重点描述了一下 Plan 模式的规则，比如使用 <code>read_file</code> <code>search_files</code> 等工具了解信息，特别推荐使用图表直观展示信息，并强调 Plan 模式下会使用 <code>plan_mode_respond</code> 工具回复信息。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能-capabilities">功能 CAPABILITIES<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#%E5%8A%9F%E8%83%BD-capabilities" class="hash-link" aria-label="功能 CAPABILITIES的直接链接" title="功能 CAPABILITIES的直接链接">​</a></h3>
<p>这一大段相当于把上面的工具集进行了一次总结，告诉模型有用哪些能力，可以使用哪些特定工具来完成特定的功能，比如命令行：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">You can use the execute_command tool to run commands on the user's computer whenever you feel it can help accomplish the user's task. When you need to execute a CLI command, you must provide a clear explanation of what the command does. ......</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="规则-rules">规则 RULES<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#%E8%A7%84%E5%88%99-rules" class="hash-link" aria-label="规则 RULES的直接链接" title="规则 RULES的直接链接">​</a></h3>
<p>规则部分主要强调了什么可以做，什么不能做。比如不可以使用 ~ 或 $HOME 来表示用户的主目录，不可以使用 cd 命令，不能口语化，必须等待用户确认。这里使用了大量的<code>** **</code> 加粗的标记提醒模型。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="系统信息">系统信息<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF" class="hash-link" aria-label="系统信息的直接链接" title="系统信息的直接链接">​</a></h3>
<p>获取系统信息，这些可以帮助命令行工具、文本读写工具的执行。</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Operating System</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token function" style="color:#d73a49">osName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default Shell</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token function" style="color:#d73a49">getShell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Home Directory</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">homedir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toPosix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current Working Directory</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">cwd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toPosix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="目标">目标<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#%E7%9B%AE%E6%A0%87" class="hash-link" aria-label="目标的直接链接" title="目标的直接链接">​</a></h3>
<p>这里奠定了 Cline 处理问题的基调，我完整的贴在这里：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">你通过迭代的方式完成给定的任务，将其分解为清晰的步骤，并有条不紊地逐一执行。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">分析用户的任务</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">，设定明确且可实现的目标以完成它。按逻辑顺序对这些目标进行优先级排序。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> 依次处理这些目标，在必要时一次使用一个可用工具。每个目标应对应你解决问题过程中的一个具体步骤。在整个过程中，你会被告知已完成的工作和剩余的任务。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">3.</span><span class="token plain"> 请记住，你拥有广泛的工具能力，可以灵活、巧妙地运用这些工具来完成每一个目标。在调用任何工具之前，请在 </span><span class="token code-snippet code keyword" style="color:#00009f">`&lt;thinking&gt;&lt;/thinking&gt;`</span><span class="token plain"> 标签中进行分析：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 首先，分析 </span><span class="token code-snippet code keyword" style="color:#00009f">`environment_details`</span><span class="token plain"> 中提供的文件结构，以获取上下文和洞察，从而有效地推进任务。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 然后，思考哪个可用工具最相关，能够帮助你完成用户任务。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 接着，逐个检查该工具所需的参数，并判断用户是否已直接提供或提供了足够的信息用于推断参数值。在决定能否推断某个参数值时，请仔细考虑所有上下文，看是否支持特定的取值。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 如果所有必需的参数都已存在或可以合理推断，则关闭 </span><span class="token code-snippet code keyword" style="color:#00009f">`&lt;thinking&gt;`</span><span class="token plain"> 标签并继续执行工具操作。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">但如果有一个必需参数的值缺失</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">，</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">不要调用该工具</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">（即使填入占位符也不行），而是使用 </span><span class="token code-snippet code keyword" style="color:#00009f">`ask_followup_question`</span><span class="token plain"> 工具向用户请求缺失的参数。如果未提供的是</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">可选参数</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">，则</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">不要主动询问</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">4.</span><span class="token plain"> 完成用户的任务后，你必须使用 </span><span class="token code-snippet code keyword" style="color:#00009f">`attempt_completion`</span><span class="token plain"> 工具将结果提交给用户。你也可以提供一条 CLI 命令来展示任务的结果；这对于 Web 开发任务尤其有用，例如你可以运行 </span><span class="token code-snippet code keyword" style="color:#00009f">`open index.html`</span><span class="token plain"> 来展示你构建的网站。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">5.</span><span class="token plain"> 用户可能会提供反馈，你可以根据反馈进行改进并重新尝试。但</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">不要陷入无意义的来回对话中</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">，也就是说，</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">不要以问题或提供进一步帮助的提议结束你的回复</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="自定义-system-prompt">自定义 System Prompt<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#%E8%87%AA%E5%AE%9A%E4%B9%89-system-prompt" class="hash-link" aria-label="自定义 System Prompt的直接链接" title="自定义 System Prompt的直接链接">​</a></h3>
<p>在 <code>addUserInstructions</code> 方法中，追加用户自定义的指令，这里包括了 <a href="https://docs.cline.bot/features/cline-rules" target="_blank" rel="noopener noreferrer">Cline Rules</a>。我们可以在项目根目录下新建 <code>.clinerules/</code> 存放 Cline Rule，Cline 作为 System Prompt 最有效的补充，可以针对不同的项目做不同的定制。</p>
<p>甚至追加了 Cursor 或者 Windsurf 的 Rule。😂</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">localCursorRulesFileInstructions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customInstructions </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> localCursorRulesFileInstructions </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"\n\n"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">localCursorRulesDirInstructions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customInstructions </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> localCursorRulesDirInstructions </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"\n\n"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">localWindsurfRulesFileInstructions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customInstructions </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> localWindsurfRulesFileInstructions </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"\n\n"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="claude4-支持">Claude4 支持<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#claude4-%E6%94%AF%E6%8C%81" class="hash-link" aria-label="Claude4 支持的直接链接" title="Claude4 支持的直接链接">​</a></h3>
<p>Cline 3.17.9 版本对 Claude4 做了特殊支持 <code>src/core/prompts/model_prompts/claude4.ts</code> 以及 <code>src/core/prompts/model_prompts/claude4-experimental.ts</code>。据官方博客描述，在使用新的 Claude4 模型时，会遇到一些编辑错误。</p>
<blockquote>
<p>这次版本更新主要关注 Cline 与 Claude 4 之间的交互，尤其是在搜索和替换操作上。我们调整了分隔符方法，将 &lt; 和 &gt; 替换为 - 和 + ，这在我们的内部测试中显示出了积极的效果，减少了编辑失败，提高了代码修改的成功率。</p>
</blockquote>
<p>这也给我们带来了一些提示：在模型切换时，需要及时的测试和调整 Prompt，以更好的适应更新更强大的模型。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="command-和-workflow">Command 和 Workflow<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#command-%E5%92%8C-workflow" class="hash-link" aria-label="Command 和 Workflow的直接链接" title="Command 和 Workflow的直接链接">​</a></h2>
<p>除了 Cline Rules，Cline 还提供了其他方式来让用户定制 Prompt。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="slash-command">Slash Command<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#slash-command" class="hash-link" aria-label="Slash Command的直接链接" title="Slash Command的直接链接">​</a></h3>
<p>Cline 提供了 Slash Command 的概念，通过 <code>/</code> 触发。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img19@main/2025/06/11/1749635423130-0b111dc0-9024-4a6f-bdab-9ece17bf3e45.png" alt="" class="img_ev3q"></p>
<p>不像 Cline Rule 会针对每个任务生效，Command 在实现特定类型任务的时候很有用。比如我们要反馈 Bug，就可以使用内置的 <code>/reportBug</code> 触发任务。而比如在执行其他任务，比如写代码时，不带上这个命令，也就不会发送相应的提示词给模型。</p>
<p>Command 相应的提示词位于 <code>src/core/prompts/commands.ts</code>，提示词组装过程中，会调用 <code>src/core/slash-commands/index.ts</code> 文件的 <code>parseSlashCommands</code>  方法，将 <code>/</code> 命令替换为指定的提示词。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="workflow">Workflow<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#workflow" class="hash-link" aria-label="Workflow的直接链接" title="Workflow的直接链接">​</a></h3>
<p>如果要自定义 Command，除了源码层面定制，Cline 也支持用户手动配置，Cline 称其为 Workflow，Workflow 允许用户自定义步骤来处理特定的任务。在 <code>.clinerules</code> 目录下新建 <code>workflows</code> 目录，目录下新建 markdown 文件，文件内容我处理特定任务的步骤。这时候聊天框中输入 <code>/</code>，就会发现命令列表多了我们定制的 <code>/[workflow-name.md]</code>。</p>
<p>这部分逻辑依然在 <code>parseSlashCommands</code> 方法内，Command 和 Workflow 都会处理成 <code>/</code> 命令。</p>
<p>可以参照 Cline 仓库的 <code>.clinerules/workflows/pr-review.md</code> 编写自己的 Workflow。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mention-">Mention @<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#mention-" class="hash-link" aria-label="Mention @的直接链接" title="Mention @的直接链接">​</a></h2>
<p>@ 在 Cline 中是作为引用外部资源扩展上下文存在的。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img11@main/2025/06/11/1749649934154-2a274dec-1ff4-4c14-8e42-4e1a84366bc3.png" alt="" class="img_ev3q"></p>
<p>比如你可以 @ 一个文件路径，那这个文件的内容就会作为 Prompt 带给大模型。格式如下：</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">file_content</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">path</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">path/to/file</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Complete file content]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">file_content</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>除了文件，还可以 @ 问题、命令行甚至是一个 url，不必输入大段文字即可提供给模型更丰富的上下文信息。</p>
<p>mention 相关处理位于 <code>src/core/mentions/index.ts</code>，处理了各种 @ 信息。实践中，我们可以扩展 @能力，比如 @我们内部的知识库来让 Cline 更好的了解团队内部知识。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="memery-bank">Memery Bank<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#memery-bank" class="hash-link" aria-label="Memery Bank的直接链接" title="Memery Bank的直接链接">​</a></h2>
<p>Memery Bank 是 Cline Agent 记忆系统的一个解决方案，[Cline Blog] 将 Memery Bank 比喻为笔记本，随着项目的更新持续的更新笔记，这样在开始新任务丢失历史记录和上下文的情况下，Cline 依旧可以通过笔记本里的内容了解项目全貌、技术架构以及当前进度等信息。</p>
<p>我们可以在 <code>.clinerules</code> 目录下新建 <code>memory-bank.md</code>，内容可以参照官方文档给出的<a href="https://docs.cline.bot/prompting/cline-memory-bank" target="_blank" rel="noopener noreferrer">示例</a>。</p>
<p>这份示例要求模型以如下的文档关系整理笔记本：</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img19@main/2025/06/12/1749734819909-17e56603-1947-4c2c-acac-4ec4a589f638.png" alt="" class="img_ev3q"></p>
<p>这六个文件分别作用为：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">projectbrief.md: 项目简介，奠定一切的基础文档</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">productContext.md: 产品上下文，商业和用户视角</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemPatterns.md: 技术架构与决策</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">techContext.md: 开发环境和技术栈</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">activeContext.md: 当前开发状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">progress.md: 项目进度与跟踪</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>实际工作中，工作前需要确认 Memory Bank 文件，获取必要的上下文知识，如果项目有重大更新，则更新相关文档，以应对上下文丢失的情况。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img15@main/2025/06/12/1749735115693-dbaf9940-685d-4e0f-8842-0a56c94c845e.png" alt="" class="img_ev3q"></p>
<p>在 Memory Bank 中，Cline 提倡以 Mermaid 图表作为 Prompt，Cline 团队认为：</p>
<blockquote>
<p>与 AI 交流的最佳方式并非自然语言——而是工作流的结构化语言。</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接">​</a></h2>
<p>Cline 的 Prompt 非常有<strong>模块化</strong>的设计思想。Cline 将 Prompt 划分为 System Prompt、Command、Workflow、Mention、Memery 等模块，System Prompt 则划分为工具、MCP、目标、Mode 等模块，针对全局、特定或者全新的任务使用不同的 Prompt 来解决。</p>
<p>同时我们也发现 Cline 事无巨细，非常“啰嗦”，比如 System Prompt 关于工具调用格式就出现了好几次；尽可能多的提供上下文，这让 Cline 非常的消耗 Token。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img17@main/2025/05/30/1748572666434-e20a0717-a388-47c9-8332-832423e6b337.png" alt="openrouter 网站的统计，Cline 遥遥领先" class="img_ev3q"></p>
<p>如何写出好用的 Prompt，个人感觉主要是两点：</p>
<ol>
<li>足够的上下文和示例（身份、目标、工具、示例等等）</li>
<li>足够详细和明确的执行步骤（Workflow）</li>
</ol>
<p>最后，可以查看官方文档<a href="https://docs.cline.bot/prompting/prompt-engineering-guide" target="_blank" rel="noopener noreferrer">提示词工程指南</a>进一步了解如何为 Cline 写出更好用的 Prompt。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="Cline" term="Cline"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Cline 源码浅析 - MCP 调用]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-06-10-cline-source-code-mcp.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-06-10-cline-source-code-mcp.md"/>
        <updated>2025-06-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[上一篇文章Cline 源码浅析 - 从输入到输出，从源码角度浏览了一下 Cline 处理用户输入到最后输出的过程，本文看一下其中关于 MCP 的处理。]]></summary>
        <content type="html"><![CDATA[<p>上一篇文章<a href="https://mp.weixin.qq.com/s/9bJAeQ3U0_U85sDCcJSXxw" target="_blank" rel="noopener noreferrer">Cline 源码浅析 - 从输入到输出</a>，从源码角度浏览了一下 Cline 处理用户输入到最后输出的过程，本文看一下其中关于 MCP 的处理。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img17@main/2025/06/06/1749176746221-f97aba25-6da5-461a-be21-369de1c44fff.png" alt="" class="img_ev3q"></p>
<blockquote>
<p>关于 MCP，可以查看<a href="https://modelcontextprotocol.io/introduction" target="_blank" rel="noopener noreferrer">官方文档</a></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cline-mcp">Cline MCP<a href="https://sleepy-zone.github.io/blog/2025-06-10-cline-source-code-mcp.md#cline-mcp" class="hash-link" aria-label="Cline MCP的直接链接" title="Cline MCP的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何配置-mcp-server">如何配置 MCP Server<a href="https://sleepy-zone.github.io/blog/2025-06-10-cline-source-code-mcp.md#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE-mcp-server" class="hash-link" aria-label="如何配置 MCP Server的直接链接" title="如何配置 MCP Server的直接链接">​</a></h3>
<p>我们打开 Cline 的 MCP 界面，可以看到 Cline 提供了多种配置 MCP 的方式：</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img14@main/2025/06/09/1749464726040-18f47f48-723f-41ee-9d7f-59d2f65144e5.png" alt="" class="img_ev3q"></p>
<p>本质上都是将 MCP 配置写入设置目录下的 <code>cline_mcp_settings.json</code> 文件，这里我们配置一个根据姓名查询工号的 MCP Server。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"mcpServers"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"name2empid"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"autoApprove"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"disabled"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"timeout"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"url"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://xxxx.com/xxx/sse"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"sse"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>另外 Cline 自行维护了一个 MCP 市场，用户可以从中选择安装，Cline 提供了一个比较有意思的安装方式，当你点击 Install 的时候，他并不是简单的把配置写入配置文件，而是通过大模型来进行安装（从访问文档到安装到验证），代码位于 <code>src/core/controller/mcp/downloadMcp.ts</code>，提示词如下：</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Create task with context from README and added guidelines for MCP server installation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Set up the MCP server from </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">mcpDetails</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">githubUrl</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> while adhering to these MCP server installation rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">- Start by loading the MCP documentation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">- Use "</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">mcpDetails</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">mcpId</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">" as the server name in cline_mcp_settings.json.</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">- Create the directory for the new MCP server before starting installation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">- Make sure you read the user's existing cline_mcp_settings.json file before editing it with this new mcp, to not overwrite any existing servers.</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">- Use commands aligned with the user's shell and operating system best practices.</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">- The following README may contain instructions that conflict with the user's OS, in which case proceed thoughtfully.</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">- Once installed, demonstrate the server's capabilities by using one of its tools.</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">Here is the project's README to help you get started:\n\n</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">mcpDetails</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">readmeContent</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">\n</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">mcpDetails</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">llmsInstallationContent</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="源码阅读">源码阅读<a href="https://sleepy-zone.github.io/blog/2025-06-10-cline-source-code-mcp.md#%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB" class="hash-link" aria-label="源码阅读的直接链接" title="源码阅读的直接链接">​</a></h3>
<p>MCP 配置相关的代码位于：<code>src/services/mcp/McpHub.ts</code>，这里本质就是一个 MCP Client 初始化的逻辑，根据配置连接 Server 获取 Tool。</p>
<p>连接的 Server 的代码位于 <code>connectToServer</code>，调用 <code>@modelcontextprotocol/sdk/client</code> 这个包初始化 Client。</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Client</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Cline"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clientVersion</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    capabilities</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 处理不同的类型的 Server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">transport </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">StdioClientTransport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">transport </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SSEClientTransport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">transport </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">StreamableHTTPClientTransport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">transport</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后获取 tool 和 resource：</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Initial fetch of tools and resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tools </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fetchToolsList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fetchResourcesList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resourceTemplates </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fetchResourceTemplatesList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>MCP Client 的工作初始化完成。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mcp-的使用">MCP 的使用<a href="https://sleepy-zone.github.io/blog/2025-06-10-cline-source-code-mcp.md#mcp-%E7%9A%84%E4%BD%BF%E7%94%A8" class="hash-link" aria-label="MCP 的使用的直接链接" title="MCP 的使用的直接链接">​</a></h2>
<p>下面看一下我们配置好的 MCP Server 是如何在我们的任务中运作的。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="system-prompt">System Prompt<a href="https://sleepy-zone.github.io/blog/2025-06-10-cline-source-code-mcp.md#system-prompt" class="hash-link" aria-label="System Prompt的直接链接" title="System Prompt的直接链接">​</a></h3>
<p><a href="https://mp.weixin.qq.com/s/9bJAeQ3U0_U85sDCcJSXxw" target="_blank" rel="noopener noreferrer">上一篇文章</a>我们得知，System Prompt 是实时拼接的，这里把 MCP Server 相关的 Prompt 贴在这里：</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> systemPrompt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">MCP SERVERS</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">The Model Context Protocol (MCP) enables communication between the system and locally running MCP servers that provide additional tools and resources to extend your capabilities.</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c"># Connected MCP Servers</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">When a server is connected, you can use the server's tools via the \`use_mcp_tool\` tool, and access the server's resources via the \`access_mcp_resource\` tool.</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c"></span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">	mcpHub</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation function" style="color:#d73a49">getServers</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">length </span><span class="token template-string interpolation operator" style="color:#393A34">&gt;</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:#36acaa">0</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">		</span><span class="token template-string interpolation operator" style="color:#393A34">?</span><span class="token template-string interpolation"> `$</span><span class="token template-string interpolation punctuation" style="color:#393A34">{</span><span class="token template-string interpolation">mcpHub</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">				</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation function" style="color:#d73a49">getServers</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">				</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation function" style="color:#d73a49">filter</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">server</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34">=&gt;</span><span class="token template-string interpolation"> server</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">status </span><span class="token template-string interpolation operator" style="color:#393A34">===</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation string" style="color:#e3116c">"connected"</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">				</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation function" style="color:#d73a49">map</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">server</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34">=&gt;</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation punctuation" style="color:#393A34">{</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">					</span><span class="token template-string interpolation keyword" style="color:#00009f">const</span><span class="token template-string interpolation"> tools </span><span class="token template-string interpolation operator" style="color:#393A34">=</span><span class="token template-string interpolation"> server</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">						</span><span class="token template-string interpolation operator" style="color:#393A34">?.</span><span class="token template-string interpolation function" style="color:#d73a49">map</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">tool</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34">=&gt;</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation punctuation" style="color:#393A34">{</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">							</span><span class="token template-string interpolation keyword" style="color:#00009f">const</span><span class="token template-string interpolation"> schemaStr </span><span class="token template-string interpolation operator" style="color:#393A34">=</span><span class="token template-string interpolation"> tool</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">inputSchema</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">								</span><span class="token template-string interpolation operator" style="color:#393A34">?</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation template-string string" style="color:#e3116c">    Input Schema:</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation template-string string" style="color:#e3116c">    </span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation constant" style="color:#36acaa">JSON</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation function" style="color:#d73a49">stringify</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation template-string interpolation">tool</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">inputSchema</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">,</span><span class="token template-string interpolation template-string interpolation"> </span><span class="token template-string interpolation template-string interpolation keyword" style="color:#00009f">null</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">,</span><span class="token template-string interpolation template-string interpolation"> </span><span class="token template-string interpolation template-string interpolation number" style="color:#36acaa">2</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation function" style="color:#d73a49">split</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation template-string interpolation string" style="color:#e3116c">"\n"</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation function" style="color:#d73a49">join</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation template-string interpolation string" style="color:#e3116c">"\n    "</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">								</span><span class="token template-string interpolation operator" style="color:#393A34">:</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation string" style="color:#e3116c">""</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">							</span><span class="token template-string interpolation keyword" style="color:#00009f">return</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation template-string string" style="color:#e3116c">- </span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">tool</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">name</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string string" style="color:#e3116c">: </span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">tool</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">description</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string string" style="color:#e3116c">\n</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">schemaStr</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">						</span><span class="token template-string interpolation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">						</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation function" style="color:#d73a49">join</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation string" style="color:#e3116c">"\n\n"</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">					</span><span class="token template-string interpolation keyword" style="color:#00009f">const</span><span class="token template-string interpolation"> templates </span><span class="token template-string interpolation operator" style="color:#393A34">=</span><span class="token template-string interpolation"> server</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">resourceTemplates</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">						</span><span class="token template-string interpolation operator" style="color:#393A34">?.</span><span class="token template-string interpolation function" style="color:#d73a49">map</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">template</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34">=&gt;</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation template-string string" style="color:#e3116c">- </span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">template</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">uriTemplate</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string string" style="color:#e3116c"> (</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">template</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">name</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string string" style="color:#e3116c">): </span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">template</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">description</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">						</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation function" style="color:#d73a49">join</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation string" style="color:#e3116c">"\n"</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">					</span><span class="token template-string interpolation keyword" style="color:#00009f">const</span><span class="token template-string interpolation"> resources </span><span class="token template-string interpolation operator" style="color:#393A34">=</span><span class="token template-string interpolation"> server</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">						</span><span class="token template-string interpolation operator" style="color:#393A34">?.</span><span class="token template-string interpolation function" style="color:#d73a49">map</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">resource</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34">=&gt;</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation template-string string" style="color:#e3116c">- </span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">resource</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">uri</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string string" style="color:#e3116c"> (</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">resource</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">name</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string string" style="color:#e3116c">): </span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">resource</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">description</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">						</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation function" style="color:#d73a49">join</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation string" style="color:#e3116c">"\n"</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">					</span><span class="token template-string interpolation keyword" style="color:#00009f">const</span><span class="token template-string interpolation"> config </span><span class="token template-string interpolation operator" style="color:#393A34">=</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation constant" style="color:#36acaa">JSON</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation function" style="color:#d73a49">parse</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">server</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">config</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">					</span><span class="token template-string interpolation keyword" style="color:#00009f">return</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">						</span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation template-string string" style="color:#e3116c">## </span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">server</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">name</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string string" style="color:#e3116c"> (\`</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">config</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">command</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">config</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">args </span><span class="token template-string interpolation template-string interpolation operator" style="color:#393A34">&amp;&amp;</span><span class="token template-string interpolation template-string interpolation"> </span><span class="token template-string interpolation template-string interpolation builtin">Array</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation function" style="color:#d73a49">isArray</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation template-string interpolation">config</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation">args</span><span class="token template-string interpolation template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation template-string interpolation"> </span><span class="token template-string interpolation template-string interpolation operator" style="color:#393A34">?</span><span class="token template-string interpolation template-string interpolation"> </span><span class="token template-string interpolation template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation template-string interpolation template-string string" style="color:#e3116c"> </span><span class="token template-string interpolation template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation template-string interpolation">config</span><span class="token template-string interpolation template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation template-string interpolation">args</span><span class="token template-string interpolation template-string interpolation template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation template-string interpolation template-string interpolation function" style="color:#d73a49">join</span><span class="token template-string interpolation template-string interpolation template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation template-string interpolation template-string interpolation string" style="color:#e3116c">" "</span><span class="token template-string interpolation template-string interpolation template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation template-string interpolation"> </span><span class="token template-string interpolation template-string interpolation operator" style="color:#393A34">:</span><span class="token template-string interpolation template-string interpolation"> </span><span class="token template-string interpolation template-string interpolation string" style="color:#e3116c">""</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string string" style="color:#e3116c">\`)</span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34">+</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">						</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">tools </span><span class="token template-string interpolation operator" style="color:#393A34">?</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation template-string string" style="color:#e3116c">\n\n### Available Tools\n</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">tools</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34">:</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation string" style="color:#e3116c">""</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34">+</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">						</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">templates </span><span class="token template-string interpolation operator" style="color:#393A34">?</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation template-string string" style="color:#e3116c">\n\n### Resource Templates\n</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">templates</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34">:</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation string" style="color:#e3116c">""</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34">+</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">						</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">resources </span><span class="token template-string interpolation operator" style="color:#393A34">?</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation template-string string" style="color:#e3116c">\n\n### Direct Resources\n</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation template-string interpolation">resources</span><span class="token template-string interpolation template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:#393A34">:</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation string" style="color:#e3116c">""</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">					</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string interpolation">				</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">				.join("\n\n")}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"(No MCP servers currently connected)"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>MCP Server 的相关提示词在 System Prompt  Tool Use Guidelines 部分，通过遍历 McpHub 内所有 server，将 server 内的 tool 格式化的拼接到 Prompt 中。大致格式为：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> name2empid(node xxx.ts)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Available Tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> get_empid_by_name: 根据员工姓名查询工号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	Input Schema: {"name": "string"}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>同时还提供给模型一个调用 MCP Server Tool 的示例：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Example 5: Requesting to use an MCP tool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">use_mcp_tool</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">server_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">weather-server</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">server_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">tool_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">get_forecast</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">tool_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">arguments</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "city": "San Francisco",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "days": 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">arguments</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">use_mcp_tool</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>涉及到 MCP 调用统一使用 <code>use_mcp_tool</code> 工具，然后再指定是哪个 MCP 工具。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型调用">模型调用<a href="https://sleepy-zone.github.io/blog/2025-06-10-cline-source-code-mcp.md#%E6%A8%A1%E5%9E%8B%E8%B0%83%E7%94%A8" class="hash-link" aria-label="模型调用的直接链接" title="模型调用的直接链接">​</a></h3>
<p>比如我们问“查询张三的工号”，模型输出类似下面这样：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">thinking</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">我需要查询"张三"的工号。根据任务描述，我需要使用name2empid MCP服务器提供的工具来获取员工的工号。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">我可以使用</span><span class="token code-snippet code keyword" style="color:#00009f">`use_mcp_tool`</span><span class="token plain">工具来调用name2empid服务器的</span><span class="token code-snippet code keyword" style="color:#00009f">`get_empid_by_name`</span><span class="token plain">工具，该工具可以根据员工姓名获取工号。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">需要的参数是:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> server_name: "name2empid"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> tool_name: "get_empid_by_name"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> arguments: 包含员工姓名的JSON对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">我已经有了所有必要的信息，可以直接调用这个工具。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">thinking</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">use_mcp_tool</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">server_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">name2empid</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">server_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">tool_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">get_empid_by_name</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">tool_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">arguments</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "name": "张三"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">arguments</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">use_mcp_tool</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>经过 <code>parseAssistantMessageV2</code> 和 <code>presentAssistantMessage</code>  两个方法，会从模型输出中解析出使用的 MCP Tool 以及参数，和内置的 Tool 逻辑基本类似。</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'use_mcp_tool'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">server_name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'name2empid'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tool_name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'get_empid_by_name'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> arguments</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'{\n  "name": "张三"\n}'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arguments </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'{\n  "name": "张三"\n}'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'name2empid'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tool_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'get_empid_by_name'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此时，Cline 会执行 McpHub 内的 <code>callTool</code> 方法获取结果，后面再将结果交给模型，得到最终输出，自此任务结束。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://sleepy-zone.github.io/blog/2025-06-10-cline-source-code-mcp.md#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接">​</a></h2>
<p>如果觉得 Cline 源码太复杂，可以直接看 <a href="https://modelcontextprotocol.io/quickstart/client#node" target="_blank" rel="noopener noreferrer">MCP 官方的 Client DEMO</a>，比较清晰。</p>
<p>MCP 大大扩展了模型能力，可以在让模型发挥更好的价值。Cline 在 MCP 的管理和调用上设计的都很巧妙，尤其是 System Prompt，下一篇文章我们将探讨一下 Cline 的 Prompt 设计。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="Cline" term="Cline"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Cline 源码浅析 - 从输入到输出]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-06-07-cline-source-code-1.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-06-07-cline-source-code-1.md"/>
        <updated>2025-06-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[我们在上一篇文章：现在开始使用 Cline Rules 里简单介绍过 Cline，本篇文章从源码角度来看一下从我们输入指令到 Cline 输出的过程到底是怎样的，这样对我们后续使用 Cline 会有更好的帮助。]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img17@main/2025/06/06/1749176746221-f97aba25-6da5-461a-be21-369de1c44fff.png" alt="" class="img_ev3q"></p>
<p>我们在上一篇文章：<a href="https://mp.weixin.qq.com/s/EkGEk3UrZvxIH2VV0DWdLA" target="_blank" rel="noopener noreferrer">现在开始使用 Cline Rules</a> 里简单介绍过 Cline，本篇文章从源码角度来看一下从我们输入指令到 Cline 输出的过程到底是怎样的，这样对我们后续使用 Cline 会有更好的帮助。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="启动-cline">启动 Cline<a href="https://sleepy-zone.github.io/blog/2025-06-07-cline-source-code-1.md#%E5%90%AF%E5%8A%A8-cline" class="hash-link" aria-label="启动 Cline的直接链接" title="启动 Cline的直接链接">​</a></h2>
<p>访问 Cline 的 Github 仓库 README：<a href="https://github.com/cline/cline?tab=readme-ov-file#contributing%EF%BC%9A" target="_blank" rel="noopener noreferrer">https://github.com/cline/cline?tab=readme-ov-file#contributing：</a></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/cline/cline.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code cline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run install:all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 VSCode 里 <code>F5</code> 或者 <code>Run-&gt;Start Debugging</code> 开始调试 Cline VSCode 插件。此时会新开一个 VSCode 窗口，这个窗口里我们可以愉快的调试 VSCode。</p>
<blockquote>
<p>这里可能遇到一些问题，一个是仓库里提到的，如果构建有问题，需要安装 <a href="https://marketplace.visualstudio.com/items?itemName=connor4312.esbuild-problem-matchers" target="_blank" rel="noopener noreferrer">esbuild Problem Matchers插件</a>；另外项目的 Webview 里需要安装 electron 这个巨无霸，可能会很慢，可以设置为国内源：</p>
</blockquote>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">electron_mirror=https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//npmmirror.com/mirrors/electron/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">electron_builder_binaries_mirror=https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//npmmirror.com/mirrors/electron</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">binaries/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shamefully</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hoist=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-by-step-debug">Step by Step Debug<a href="https://sleepy-zone.github.io/blog/2025-06-07-cline-source-code-1.md#step-by-step-debug" class="hash-link" aria-label="Step by Step Debug的直接链接" title="Step by Step Debug的直接链接">​</a></h2>
<p>VSCode 对自家插件的调试做的非常好，不管是 VSCode 主进程还是 Webview 内容，下面就一步一步的开始调试。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="前端输入">前端输入<a href="https://sleepy-zone.github.io/blog/2025-06-07-cline-source-code-1.md#%E5%89%8D%E7%AB%AF%E8%BE%93%E5%85%A5" class="hash-link" aria-label="前端输入的直接链接" title="前端输入的直接链接">​</a></h3>
<p>我们准备一段简单的输入：创建一个新任务，实现快速排序算法，并插入到 utils 文件内。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/newtask 实现快速排序算法，写入 @/src/utils/index.ts 文件</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>这里使用了 Cline 的内置的两个功能：内置命令 Command /newtask 以及 mention @ 功能指定了写入的文件。Command 可以理解为指定特定任务的 prompts，方便执行一些高频操作的任务，Cline 内置了诸如新建任务、创建 Rule、创建 Github Issue 等 Command。@ 功能可以指定模型特别关注的上下文，比如指定的文件内容，指定的目录内容。</p>
</blockquote>
<p>输入框内输入上述内容，点击发送，代码文件：<code>webview-ui/src/components/chat/ChatView.tsx</code>，发送消息的方法为 <code>handleSendMessage</code>，Webview 内只负责收集输入信息，实际任务处理的逻辑都会发送至 VSCode 的主进程内，VSCode 主进程处理过程中，会实时的发送消息回 Webview。</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 文件位置 webview-ui/src/services/grpc-client-base.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"message"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Send the request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> encodedRequest </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">encodeRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vscode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">postMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"grpc_request"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  grpc_request</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fullName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> method</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// method 为 newTask</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> encodedRequest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// message 为输入的文本、图片、文件消息等</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> requestId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    is_streaming</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>message 的格式：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">files =(0) []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">images =(0) []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">text ='/newtask 创建一个快速排序算法，写入 @/src/utils/index.ts 文件'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>VSCode 主进程接收 <code>grpc_request</code> 消息进行处理。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vscode-主进程接收消息">VSCode 主进程接收消息<a href="https://sleepy-zone.github.io/blog/2025-06-07-cline-source-code-1.md#vscode-%E4%B8%BB%E8%BF%9B%E7%A8%8B%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF" class="hash-link" aria-label="VSCode 主进程接收消息的直接链接" title="VSCode 主进程接收消息的直接链接">​</a></h3>
<p>主进程处理的内容位于：<code>src/core/controller/grpc-handler.ts</code>：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token doc-comment comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">	 * Handle a gRPC request from the webview</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">	 * </span><span class="token doc-comment comment keyword" style="color:#00009f;font-style:italic">@param</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><span class="token doc-comment comment parameter" style="color:#999988;font-style:italic">service</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> The service name</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">	 * </span><span class="token doc-comment comment keyword" style="color:#00009f;font-style:italic">@param</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><span class="token doc-comment comment parameter" style="color:#999988;font-style:italic">method</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> The method name</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">	 * </span><span class="token doc-comment comment keyword" style="color:#00009f;font-style:italic">@param</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><span class="token doc-comment comment parameter" style="color:#999988;font-style:italic">message</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> The request message</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">	 * </span><span class="token doc-comment comment keyword" style="color:#00009f;font-style:italic">@param</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><span class="token doc-comment comment parameter" style="color:#999988;font-style:italic">requestId</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> The request ID for response correlation</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">	 * </span><span class="token doc-comment comment keyword" style="color:#00009f;font-style:italic">@param</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><span class="token doc-comment comment parameter" style="color:#999988;font-style:italic">isStreaming</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> Whether this is a streaming request</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">	 * </span><span class="token doc-comment comment keyword" style="color:#00009f;font-style:italic">@returns</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> The response message or error for unary requests, void for streaming requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">	 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		service</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		requestId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		isStreaming</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		message</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		error</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		request_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到，参数和 Webview 传过来的一致。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="任务初始化">任务初始化<a href="https://sleepy-zone.github.io/blog/2025-06-07-cline-source-code-1.md#%E4%BB%BB%E5%8A%A1%E5%88%9D%E5%A7%8B%E5%8C%96" class="hash-link" aria-label="任务初始化的直接链接" title="任务初始化的直接链接">​</a></h3>
<p>经过各种封装，最终处理的任务落到了 <code>src/core/controller/index.ts</code> 的 <code>initTask</code> 方法内一个超级大的 Task 类的初始化：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mcpHub</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">workspaceTracker</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">historyItem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">updateTaskHistory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">historyItem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">postStateToWebview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">postMessageToWebview</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">reinitExistingTaskFromId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cancelTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiConfiguration</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  autoApprovalSettings</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  browserSettings</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  chatSettings</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shellIntegrationTimeout</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  terminalReuseEnabled </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enableCheckpointsSetting </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customInstructions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  images</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  files</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  historyItem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Task 类位于 <code>src/core/task/index.ts</code>，</p>
<p>在一系列的初始化后：</p>
<blockquote>
<p>初始化的代码没有过度深究，从类名来看，包括了后续任务执行中可能使用到的工具：浏览器、命令行、Url、DiffView 等；mcp 的配置；autoApproval 的配置等等。</p>
</blockquote>
<p>终于进入到实际的逻辑处理：</p>
<p>首先，根据用户配置的模型提供商信息创建 AI 的 api handler：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Now that taskId is initialized, we can build the API handler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">api </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buildApiHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">effectiveApiConfiguration</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后，进入到 <code>startTask</code> 方法：</p>
<p>say 方法会在聊天面板新增一条消息，比如下面的代码，将用户的输入信息显示在聊天面板：</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img4@main/2025/06/06/1749196272451-b424c65b-cb65-411f-9cbb-92322d586b92.png" alt="" class="img_ev3q"></p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">say</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"text"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> images</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> files</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="构建-user-prompt">构建 User Prompt<a href="https://sleepy-zone.github.io/blog/2025-06-07-cline-source-code-1.md#%E6%9E%84%E5%BB%BA-user-prompt" class="hash-link" aria-label="构建 User Prompt的直接链接" title="构建 User Prompt的直接链接">​</a></h3>
<p>接下来，构建 userContent：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 为用户输入的消息添加一个 task 标签。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> userContent</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> UserContent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"text"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    text</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">&lt;task&gt;\n</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">task</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">\n&lt;/task&gt;</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">imageBlocks</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token doc-comment comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">输出：</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">text =</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">'&lt;task&gt;\n/newtask 创建一个快速排序算法，写入 @/src/utils/index.ts 文件\n&lt;/task&gt;'</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">type =</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">'text'</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果用户提供了文件（Cline 支持用户上传文本文件），背后其实是读完文本文本，也用来构造 userContent。</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">files </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> files</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> fileContentString </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">processFilesIntoText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">files</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fileContentString</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userContent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"text"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      text</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> fileContentString</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="继续构造-prompts">继续构造 Prompts<a href="https://sleepy-zone.github.io/blog/2025-06-07-cline-source-code-1.md#%E7%BB%A7%E7%BB%AD%E6%9E%84%E9%80%A0-prompts" class="hash-link" aria-label="继续构造 Prompts的直接链接" title="继续构造 Prompts的直接链接">​</a></h3>
<p>用过 Cline 的话，我们会知道 Cline 会循环处理任务，所以 User Prompts 构造完成后，进入到 <code>initiateTaskLoop</code> 方法，真正执行任务的方法为 <code>recursivelyMakeClineRequests</code>：</p>
<p>进一步处理用户的输入信息：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">parsedUserContent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> environmentDetails</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clinerulesError</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">loadContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userContent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> includeFileDetails</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这样处理之后，用户输入重新组装为 parsedUserContent，内容比较长，这里不贴了，大致格式为：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">explicit_instructions</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">new_task</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">explicit_instructions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">task</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">用户输入</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">task</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">fileContent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">src/utils/index.ts内的文件</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">fileContent</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>再次看一下我们的输入：<code>/newtask 实现快速排序算法，写入 @/src/utils/index.ts 文件</code>，上面三段一一对应：<code>\&lt;explicit_instructions type="new_task\&gt;"</code> 对应 /newtask 命令，这是 Cline 的内置 prompt，@/src/utils/index.ts 添加了该文件内容作为上下文。</p>
<p>同时将 environmentDetails 也添加到 userContent，environmentDetails 有工作目录、当前时间、当前打开的 Tab 等。</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">userContent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parsedUserContent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// add environment details as its own text block, separate from tool results</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userContent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"text"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> text</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> environmentDetails </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>怪不得 Cline 这么耗 Token！</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型请求">模型请求<a href="https://sleepy-zone.github.io/blog/2025-06-07-cline-source-code-1.md#%E6%A8%A1%E5%9E%8B%E8%AF%B7%E6%B1%82" class="hash-link" aria-label="模型请求的直接链接" title="模型请求的直接链接">​</a></h3>
<p>继续进入 <code>attemptApiRequest</code> 方法，首先构造 System prompt：</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> isClaude4ModelFamily </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isClaude4ModelFamily</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> systemPrompt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SYSTEM_PROMPT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cwd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> supportsBrowserUse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mcpHub</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">browserSettings</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isClaude4ModelFamily</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>比较有意思的是，Cline 针对 Claude4 定制了不同的 System Prompt。</p>
<blockquote>
<p>System Prompt 里会告诉模型我们当前已经提供了哪些工具以及这些工具该如何调用（参数和规则），比如本次任务要将模型生成的代码写入已有文件，那么就需要使用到 <code>replace_in_file</code> 这个工具，这里贴一下 System Prompt 里关于  <code>replace_in_file</code> 的内容。</p>
</blockquote>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> replace_in_file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description: Request to replace sections of content in an existing file using SEARCH/REPLACE blocks that define exact changes to specific parts of the file. This tool should be used when you need to make targeted changes to specific parts of a file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> path: (required) The path of the file to modify (relative to the current working directory ${cwd.toPosix()})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> diff: (required) One or more SEARCH/REPLACE blocks following this exact format:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  \`\`\`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ------- SEARCH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [exact content to find]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =======</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [new content to replace with]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +++++++ REPLACE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  \`\`\`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Critical rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> SEARCH content must match the associated file section to find EXACTLY:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> Match character-for-character including whitespace, indentation, line endings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> Include all comments, docstrings, etc.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> SEARCH/REPLACE blocks will ONLY replace the first match occurrence.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> Including multiple unique SEARCH/REPLACE blocks if you need to make multiple changes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> Include </span><span class="token italic punctuation" style="color:#393A34">*</span><span class="token italic content">just</span><span class="token italic punctuation" style="color:#393A34">*</span><span class="token plain"> enough lines in each SEARCH section to uniquely match each set of lines that need to change.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> When using multiple SEARCH/REPLACE blocks, list them in the order they appear in the file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token list punctuation" style="color:#393A34">3.</span><span class="token plain"> Keep SEARCH/REPLACE blocks concise:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> Break large SEARCH/REPLACE blocks into a series of smaller blocks that each change a small portion of the file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> Include just the changing lines, and a few surrounding lines if needed for uniqueness.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> Do not include long runs of unchanging lines in SEARCH/REPLACE blocks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> Each line must be complete. Never truncate lines mid-way through as this can cause matching failures.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token list punctuation" style="color:#393A34">4.</span><span class="token plain"> Special operations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> To move code: Use two SEARCH/REPLACE blocks (one to delete from original + one to insert at new location)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> To delete code: Use empty REPLACE section</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Usage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">replace_in_file</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">path</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">File path here</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">path</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">diff</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Search and replace blocks here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">diff</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">replace_in_file</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>同时，System Prompt 也继续追加了用户的偏好语言，方便按照用户偏好的语言进行输出。</p>
<p>接下来发送请求：</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">systemPrompt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> contextManagementMetadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">truncatedConversationHistory</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>针对模型的输出，需要进一步处理，是直接展示在聊天面板，还是需要调用工具处理，这部分逻辑在 <code>src/core/assistant-message/parse-assistant-message.ts</code> 的 <code>parseAssistantMessageV2</code> 方法内。</p>
<p>针对我们本次创建排序算法的任务，下面是一个模型输出样例：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">thinking</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n我需要在</span><span class="token code-snippet code keyword" style="color:#00009f">`src/utils/index.ts`</span><span class="token plain">文件中添加一个快速排序算法。首先，我已经看到了文件的内容，这是一个工具函数集合文件，包含了各种实用函数，如rpx转换、vw计算、类型检查、日志记录等。\n\n我需要在这个文件中添加一个快速排序算法实现。快速排序是一种高效的排序算法，基于分治法的思想。我将实现一个通用的快速排序函数，可以对数组进行排序。\n\n我将使用</span><span class="token code-snippet code keyword" style="color:#00009f">`replace_in_file`</span><span class="token plain">工具来修改文件，在文件末尾添加快速排序算法的实现。我需要确保添加的代码与现有代码风格保持一致，并提供适当的类型注解和注释。\n\n我将在文件末尾添加快速排序算法的实现，包括：\n1. 一个主快速排序函数，接受一个数组和可选的比较函数\n2. 一个辅助函数用于分区操作\n\n让我使用</span><span class="token code-snippet code keyword" style="color:#00009f">`replace_in_file`</span><span class="token plain">工具来修改文件。\n</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">thinking</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\n</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">replace_in_file</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">path</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">src/utils/index.ts</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">path</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">diff</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n------- SEARCH\nexport const jump2UpdateApp = () =&gt; {\n  if (is… (a, b) =&gt; {\n  if (a &lt; b) return -1;\n  if (a &gt; b) return 1;\n  return 0;\n}): T[] =&gt; {\n  // 创建数组副本，不修改原数组\n  const result = [...arr];\n  \n  // 内部快速排序实现\n  const _quickSort = (arr: T[], left: number, right: number) =&gt; {\n    if (left &lt; right) {\n      const pivotIndex = partition(arr, left, right);\n      _quickSort(arr, left, pivotIndex - 1);\n      _quickSort(arr, pivotIndex + 1, right);\n    }\n  };\n  \n  // 分区操作\n  const partition = (arr: T[], left: number, right: number): number =&gt; {\n    // 选择最右边的元素作为基</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>parseAssistantMessageV2</code> 方法会解析上述输出内容，主要是从模型输出中解析出使用哪些工具以及工具的参数，比如这里我们发现模型输出中有 &lt;replace_in_file&gt;，那就说明这次需要使用 replace_in_file 工具。</p>
<p>接下来调用 <code>presentAssistantMessage</code> 方法真正将模型消息展示给用户，一方面展示文本消息，类似下图：</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img9@main/2025/06/06/1749217048970-dba8c0b7-c03c-4767-a014-845c105ab0d9.png" alt="" class="img_ev3q"></p>
<p>一方面执行上一步解析出的 tool，将模型生成代码以 diff 的方式写入文件，这里借助 VSCode 的能力创建 diffView。自此这个任务算是完成了。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://sleepy-zone.github.io/blog/2025-06-07-cline-source-code-1.md#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接">​</a></h2>
<p>抛开 Cline 中用户交互和工程处理的部分，我们发现最核心的其实只有两件事情：</p>
<ol>
<li>
<p>prompt 组装。这其中包括了 System Prompt、VSCode 和系统的环境信息、内置 Command、内置的 @ 引用（文件、目录信息）、用户的输入（文本、图片、文本文件），当然还有我们之前介绍的 Rules 以及我们提到过的 Workflow（本质是用户自定义的 Command）。这些内容共同组装称为 Prompt 发送给模型，力求给模型足够多的上下文信息，获得更加准确的结果。</p>
</li>
<li>
<p>tools 调用。首先在 System Prompt 定义了模型可以调用的 Tool（包括内置的和 MCP Server 定义的），在模型输出时指定调用的 Tool 和需要的参数，以此斤进一步增强模型的能力。</p>
</li>
</ol>
<p>两者共同合作完成用户的编码的任务。</p>
<p>由此我们可以看到 Agent 开发中最重要的三点：</p>
<ol>
<li>模型的使用</li>
<li>丰富的创意</li>
<li>丝滑的体验</li>
</ol>
<p>最后，本文是在我边调试边写作的过程中完成的，可能表达还不够清晰，欢迎有兴趣的同学一起交流指正。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="Cline" term="Cline"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[现在开始使用 Cline Rules]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-05-30-cline-rule.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-05-30-cline-rule.md"/>
        <updated>2025-05-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[写在前面]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img19@main/2025/05/30/1748588412574-e064741c-0bf1-4c61-be3c-fd9ac86453e4.png" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="写在前面">写在前面<a href="https://sleepy-zone.github.io/blog/2025-05-30-cline-rule.md#%EF%BF%BD%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2" class="hash-link" aria-label="写在前面的直接链接" title="写在前面的直接链接">​</a></h3>
<p>最近在业务（面向用户的 C 端业务）中较多的使用了 <a href="https://docs.cline.bot/getting-started/what-is-cline" target="_blank" rel="noopener noreferrer">Cline</a>，总体感觉非常丝滑（尤其是看着他在默默地生成代码并且自己排查错误的时候，但 Token 确实也消耗的很快😂）。</p>
<p>Cline 算是 VS Code AI 开发插件中的佼佼者了，并且是一个开源项目，他的一个 fork 分支 RooCode 热度也很高。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img17@main/2025/05/30/1748572666434-e20a0717-a388-47c9-8332-832423e6b337.png" alt="openrouter 网站的统计，Cline 遥遥领先" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="开始配置-cline-rules">开始配置 Cline Rules<a href="https://sleepy-zone.github.io/blog/2025-05-30-cline-rule.md#%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE-cline-rules" class="hash-link" aria-label="开始配置 Cline Rules的直接链接" title="开始配置 Cline Rules的直接链接">​</a></h3>
<p>作为一个通用的编程助手，如何能针对不同的项目进行更好的开发，除了 Cline 本身对代码的理解之外，作为用户如果能提供更多的指引，可以让 Cline 发挥更好的作用。</p>
<p>一般来说，Cline、Cursor 及其他代码 Agent 都会提供 rules 这个概念，在项目根目录下新建 rules 目录，目录下根据自己的项目可以新建各种规则文件。</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">your-project/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	├── .clinerules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		├── project.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── api.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	├── src/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	├── docs/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	└── ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果你的规则全局通用，可以将规则放置到 <code>Documents/Cline/Rules</code> 目录。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cline-rules-优势">Cline Rules 优势<a href="https://sleepy-zone.github.io/blog/2025-05-30-cline-rule.md#cline-rules-%E4%BC%98%E5%8A%BF" class="hash-link" aria-label="Cline Rules 优势的直接链接" title="Cline Rules 优势的直接链接">​</a></h3>
<p>放在项目内好处很明显：</p>
<ol>
<li>可以针对每个项目配置不同的规则；</li>
<li>作为项目源代码的一部分，进行版本控制，持续维护，跟随项目发展设置长远的 rule；</li>
<li>保证团队成员使用 AI 的行为是一致的。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cline-rules-的原则">Cline Rules 的原则<a href="https://sleepy-zone.github.io/blog/2025-05-30-cline-rule.md#cline-rules-%E7%9A%84%E5%8E%9F%E5%88%99" class="hash-link" aria-label="Cline Rules 的原则的直接链��接" title="Cline Rules 的原则的直接链接">​</a></h3>
<ol>
<li>清晰简洁：使用简单语言，避免歧义。</li>
<li>关注期望结果：描述你想要的结果，而不是具体步骤。</li>
<li>测试和迭代：试验找出最适合你的工作流程的方法。</li>
</ol>
<p>rules 本质上是自定义 prompts，和 Cline 的 system prompts 互为补充，共同为项目服务。（system promps：<a href="https://github.com/cline/cline/blob/main/src/core/prompts/model_prompts/claude4.ts%EF%BC%89" target="_blank" rel="noopener noreferrer">https://github.com/cline/cline/blob/main/src/core/prompts/model_prompts/claude4.ts）</a></p>
<p>关于提示词，我之前有总结过<a href="https://mp.weixin.qq.com/s/YFV0MO_pX3Us-PEMzxF0vQ" target="_blank" rel="noopener noreferrer">谷歌的提示词最佳实践</a>，可以看一下。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="高级用法-rules-bank">高级用法 Rules Bank<a href="https://sleepy-zone.github.io/blog/2025-05-30-cline-rule.md#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95-rules-bank" class="hash-link" aria-label="高级用法 Rules Bank的直接链接" title="高级用法 Rules Bank的直接链接">​</a></h3>
<p>Rules Bank 顾名思义，就是存放 Rules 的地方，如果你的项目很复杂，又有前端、又有后端、又有不同的技术栈，这个时候就很有用。</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">your-project/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── .clinerules/              # Active rules - automatically applied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── 01-coding.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── client-a.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── clinerules-bank/          # Repository of available but inactive rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── clients/              # Client-specific rule sets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── client-a.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── client-b.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── frameworks/           # Framework-specific rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── react.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── vue.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── project-types/        # Project type standards</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── api-service.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── frontend-app.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>比如当你在开发 React 技术栈的时候，从 Rules Bank 中复制 React Rule 到 Cline Rules 内。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Switch to React</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm .clinerules/vue.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp clinerules-bank/clients/react.md .clinerules/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>总之一切文本放到代码仓库中，提高可持续性，并且可以跟随项目保持最新的迭代！</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何管理">如何管理<a href="https://sleepy-zone.github.io/blog/2025-05-30-cline-rule.md#%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86" class="hash-link" aria-label="如何管理的直接链接" title="如何管理的直接链接">​</a></h3>
<p>Cline 提供了一种方便的方式管理 Rules，在输入框下方一个天平的小标志内，可以打开 Rule 管理器，新增删除或者启用禁用 Rule。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img19@main/2025/05/30/1748590113024-f84df6e2-374d-4378-b4af-79b8b7ed9f86.png" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="最后">最后<a href="https://sleepy-zone.github.io/blog/2025-05-30-cline-rule.md#%E6%9C%80%E5%90%8E" class="hash-link" aria-label="最后的直接链接" title="最后的直接链接">​</a></h3>
<p>十分建议你在平时工作中使用 Cline，并使用 Cline Rule 增强开发体验。后面会持续更新 Cline 的相关内容。</p>
<p>最后，假期快乐！</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
        <category label="Cline" term="Cline"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Mastra  - TypeScript AI Agent 框架]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-04-30-ts-agent-mastra.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-04-30-ts-agent-mastra.md"/>
        <updated>2025-05-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[简介]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img10@main/2025/05/19/1747639233989-a54bfdd8-3570-4750-8b7c-c8f0b88ff435.png" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="https://sleepy-zone.github.io/blog/2025-04-30-ts-agent-mastra.md#%E7%AE%80%E4%BB%8B" class="hash-link" aria-label="简介的直接链接" title="简介的直接链接">​</a></h2>
<p>之前我们讨论过<a href="https://mp.weixin.qq.com/s/9KaU4LeGmkw0YGmY-XRihw?token=2043170037&amp;lang=zh_CN" target="_blank" rel="noopener noreferrer">什么是 Agent</a>，都是一些概念性的闲聊，今天介绍的 <a href="https://mastra.ai/" target="_blank" rel="noopener noreferrer">Mastra</a>，是一个难得的（一般都是 Python 框架） TS 的 AI Agent 框架，可以让你快手上手开发一个 Agent，目前已经有 13.2K 的 Star。</p>
<p><strong>前端人狂喜</strong>。</p>
<p>Mastra 提供了 Agent 所需的所有要素：</p>
<ol>
<li>大模型：基于 Vercel AI SDK。</li>
<li>Tools：工具。</li>
<li>Workflow：工作流，以支持更加复杂的工作。</li>
<li>RAG：检索增强生成，以帮助构建知识库。</li>
<li>Memery：各种存储方式集成。</li>
<li>Agent：最终的 Agent 构建。</li>
</ol>
<p>接下来，我们按照官网的快速开始，在 Next.js 框架中接入 Mastra。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="快速开始">快速开始<a href="https://sleepy-zone.github.io/blog/2025-04-30-ts-agent-mastra.md#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B" class="hash-link" aria-label="快速开始的直接链接" title="快速开始的直接链接">​</a></h2>
<ol>
<li>
<p>初始化 Next.js 结构，参照官网即可。</p>
</li>
<li>
<p>lib 目录下 新建 mastra 目录，在这个目录下开发 Agent 相关的内容。</p>
</li>
<li>
<p>新建 tools 目录，扩展大模型能力的工具，比如建一个根据城市获取天气的工具。tools 目录下新建 <code>weather-tool.ts</code> 文件。</p>
</li>
</ol>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> createTool </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@mastra/core/tools'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> z </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'zod'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">WeatherResponse</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  current</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    temperature_2m</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apparent_temperature</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    relative_humidity_2m</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wind_speed_10m</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wind_gusts_10m</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    weather_code</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> weatherTool </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTool</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'get-weather'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Get current weather for a location'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  inputSchema</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">describe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"City name"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputSchema</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    temperature</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">number</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    feelsLike</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">number</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    humidity</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">number</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    windSpeed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">number</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    windGust</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">number</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conditions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">execute</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> context </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getWeather</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">location</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">getWeather</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">location</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> geocodingUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">https://geocoding-api.open-meteo.com/v1/search?name=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation function" style="color:#d73a49">encodeURIComponent</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">location</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">&amp;count=1</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> geocodingResponse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">geocodingUrl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> geocodingData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> geocodingResponse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">geocodingData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">results</span><span class="token operator" style="color:#393A34">?.</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Location '</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">location</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">' not found</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> latitude</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> longitude</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> geocodingData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">results</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> weatherUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">https://api.open-meteo.com/v1/forecast?latitude=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">latitude</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">&amp;longitude=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">longitude</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">&amp;current=temperature_2m,apparent_temperature,relative_humidity_2m,wind_speed_10m,wind_gusts_10m,weather_code</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">weatherUrl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> WeatherResponse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    temperature</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">temperature_2m</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    feelsLike</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">apparent_temperature</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    humidity</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">relative_humidity_2m</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    windSpeed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wind_speed_10m</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    windGust</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wind_gusts_10m</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conditions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getWeatherCondition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">weather_code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getWeatherCondition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> conditions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Record</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Clear sky"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Mainly clear"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Partly cloudy"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Overcast"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">45</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Foggy"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">48</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Depositing rime fog"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">51</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Light drizzle"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">53</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Moderate drizzle"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">55</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Dense drizzle"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">56</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Light freezing drizzle"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">57</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Dense freezing drizzle"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">61</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Slight rain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">63</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Moderate rain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">65</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Heavy rain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">66</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Light freezing rain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">67</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Heavy freezing rain"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">71</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Slight snow fall"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">73</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Moderate snow fall"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">75</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Heavy snow fall"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">77</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Snow grains"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">80</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Slight rain showers"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">81</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Moderate rain showers"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">82</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Violent rain showers"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">85</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Slight snow showers"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">86</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Heavy snow showers"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">95</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Thunderstorm"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">96</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Thunderstorm with slight hail"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">99</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Thunderstorm with heavy hail"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> conditions</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Unknown"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>mastra 目录下新建 agents 目录，agent 目录下新建 <code>weather-agent.ts</code> 文件。</li>
</ol>
<p>可以看到这个天气 Agent 主要功能就是：如果用户提问天气相关的内容，模型则调用上述工具获取天气。</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Agent </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@mastra/core/agent'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> weatherTool </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'../tools/weather-tool'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> createAIModel </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@/lib/utils'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> weatherAgent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Agent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Weather Agent'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instructions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">You are a helpful weather assistant that provides accurate weather information.</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">Your primary function is to help users get weather details for specific locations. When responding:</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">- Always ask for a location if none is provided</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">- If the location name isn’t in English, please translate it</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">- Include relevant details like humidity, wind conditions, and precipitation</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">- Keep responses concise but informative</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">Use the weatherTool to fetch current weather data.</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  model</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createAIModel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'gpt-4o-mini-0718'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tools</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> weatherTool </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>模型使用的 Vercel AI SDK，如果你是用的 OpenAI 或者 Claude 等模型，可以直接使用 @ai-sdk/openai 这些包。如果你和我一样，使用的服务商统一包装的兼容 OpenAI 的接口，则可以这样：</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> createOpenAICompatible </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@ai-sdk/openai-compatible'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">createAIModel</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">modelName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createOpenAICompatible</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'custom model'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    baseURL</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'https://your-base-url/api/openai/v1/'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// api key 最好配置到 .env 文件中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apiKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'your-api-key'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">modelName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后我们建一个 agent 的入口文件 <code>mastra/index.ts</code>：</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Mastra </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@mastra/core'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> PinoLogger </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@mastra/loggers'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> LibSQLStore </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@mastra/libsql'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> weatherAgent </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./agents/weather-agent'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> mastra </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Mastra</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  agents</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> weatherAgent </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  storage</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">LibSQLStore</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// stores telemetry, evals, ... into memory storage, if it needs to persist, change to file:../mastra.db</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">':memory:'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  logger</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">PinoLogger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Mastra'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    level</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'info'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="5">
<li>一个简单的 Agent 就完成了，我们开发一个接口测试一下：</li>
</ol>
<p>在 app 目录下新建 <code>/(chat)/api/chat/route.ts</code>：</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> mastra </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@/lib/mastra'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> NextResponse </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'next/server'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">POST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">req</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> city </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> agent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mastra</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAgent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'weatherAgent'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> agent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">What's the weather like in </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">city</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">?</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toDataStreamResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="6">
<li>使用 Postman 访问 <a href="http://localhost:3000/api/talk" target="_blank" rel="noopener noreferrer">http://localhost:3000/api/talk</a> 接口测试一下：</li>
</ol>
<p><strong>流式返回了天气信息！！</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">f</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"messageId"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"msg-xZkgBuDjmIEtRWqu0wB6kNFw"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">9</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"toolCallId"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"call_iQt37jB3orK3HhY0ZGBWUClB"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"toolName"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"weatherTool"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"args"</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"location"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"New York"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"toolCallId"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"call_iQt37jB3orK3HhY0ZGBWUClB"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"result"</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"temperature"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9.2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"feelsLike"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"humidity"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">88</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"windSpeed"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">13.2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"windGust"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">36.7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"conditions"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"Overcast"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"location"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"New York"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"finishReason"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"tool-calls"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"usage"</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"promptTokens"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">99</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"completionTokens"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"isContinued"</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"messageId"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"msg-Bhwx7fT1X0zQTxBnKAeb00xi"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"The"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" current"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" weather"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" in"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" New"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" York"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" is"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" as"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" follows"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">":\n\n"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"-"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" **"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"Temperature"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">":**"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" "</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"9"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"°C"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" ("</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"Feels"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" like"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" "</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"6"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"5"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"°C"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">")\n"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"-"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" **"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"Humidity"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">":**"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" "</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"88"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"%\n"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"-"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" **"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"Wind"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" Speed"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">":**"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" "</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"13"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" km"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"/h"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"\n"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"-"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" **"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"Wind"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" Gust"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"s"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">":**"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" "</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"36"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"7"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" km"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"/h"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"\n"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"-"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" **"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"Conditions"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">":**"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" Over"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"cast"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"\n\n"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"If"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" you"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" need"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" more"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" details"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" or"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" information"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" about"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" another"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" location"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">","</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" feel"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" free"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" to"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">" ask"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"!"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"finishReason"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"stop"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"usage"</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"promptTokens"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">145</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"completionTokens"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">88</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"isContinued"</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"finishReason"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"stop"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"usage"</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"promptTokens"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">244</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"completionTokens"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">92</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="7">
<li>如果有更复杂的需求，可以尝试 Workflow ，使用不同的模型处理多个任务，最终组合称为一个更好的 Agent。这里就不展开了。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="写在后面">写在后面<a href="https://sleepy-zone.github.io/blog/2025-04-30-ts-agent-mastra.md#%E5%86%99%E5%9C%A8%E5%90%8E%E9%9D%A2" class="hash-link" aria-label="写在后面的直接链接" title="写在后面的直接链接">​</a></h2>
<p>很欣喜能看到一个 TS 的 Agent 框架，而且从文档代码来看，完成度和质量都很高。</p>
<p>但我们应该意识到，除了 Agent 开发工具，更重要的是找到<strong>合适的落地场景</strong>。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[DeepWiki - 阅读开源代码的神器]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-04-30-deepwiki.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-04-30-deepwiki.md"/>
        <updated>2025-04-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[以后推荐开源项目：]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img17@main/2025/04/29/1745915063123-0603daf0-f9b8-42af-9597-59570e3a7eae.png" alt="" class="img_ev3q"></p>
<p>以后推荐开源项目：
❌ <a href="https://github.com/xx/yy" target="_blank" rel="noopener noreferrer">https://github.com/xx/yy</a>
✅ <a href="https://deepwiki.com/xx/yy" target="_blank" rel="noopener noreferrer">https://deepwiki.com/xx/yy</a></p>
<hr>
<p>Devin （就是那个每月 500 刀的 AI 程序员）团队推出了 DeepWiki（<a href="https://deepwiki.org/%EF%BC%89%EF%BC%8C%E4%BB%8E%E6%AD%A4%E9%98%85%E8%AF%BB%E6%BA%90%E7%A0%81%E6%9B%B4%E6%96%B9%E4%BE%BF%E4%BA%86%E3%80%82" target="_blank" rel="noopener noreferrer">https://deepwiki.org/），从此阅读源码更方便了。</a></p>
<p>只需要将开源项目链接的 github.com 替换为 deepwiki.com，就可以得到一份详尽的项目文档，比如：<a href="https://deepwiki.com/vercel/ai-chatbot%E3%80%82" target="_blank" rel="noopener noreferrer">https://deepwiki.com/vercel/ai-chatbot。</a></p>
<p>（比源文档详细的多：<a href="https://chat-sdk.dev/docs/getting-started/overview%EF%BC%89" target="_blank" rel="noopener noreferrer">https://chat-sdk.dev/docs/getting-started/overview）</a></p>
<p>甚至文档内还有图表：</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img15@main/2025/04/29/1745915703384-ecf58d95-9a66-4f07-ab5e-55419797e20d.png" alt="" class="img_ev3q"></p>
<p>并且可以基于文档进行问答：</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img8@main/2025/04/29/1745915759075-d06bf6c0-3266-4d8d-ad7d-ab2aa7c0eba8.png" alt="" class="img_ev3q"></p>
<p>快去试试吧！</p>
<p>最后祝大家五一假期快乐！</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[谷歌提示词工程 - 最佳实践]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md"/>
        <updated>2025-04-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[接上文谷歌提示词工程 - 模型原理和提示词技术，讨论提示词的最佳实践。]]></summary>
        <content type="html"><![CDATA[<p>接上文<a href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md">谷歌提示词工程 - 模型原理和提示词技术</a>，讨论提示词的最佳实践。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img6@main/2025/04/23/1745392049583-b2db7b1e-2f2b-4565-8252-14f946e00719.png" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="提供示例">提供示例<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E6%8F%90%E4%BE%9B%E7%A4%BA%E4%BE%8B" class="hash-link" aria-label="提供示例的直接链接" title="提供示例的直接链接">​</a></h3>
<p>正如上文提示词技术提到的单样本、少样本那样，在提示中提供样例十分重要。这样模型就能在示例的参考下输出更加准确的内容。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="简约设计">简约设计<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E7%AE%80%E7%BA%A6%E8%AE%BE%E8%AE%A1" class="hash-link" aria-label="简约设计的直接链接" title="简约设计的直接链接">​</a></h3>
<p>基本原则是：若你自己都觉得困惑，模型很可能也会困惑。避免使用复杂语言，且不要提供无关信息。</p>
<p>尝试使用描述动作的动词。以下是一组示例：</p>
<blockquote>
<p>行动、分析、归类、分类、对比、比较、创造、描述、定义、评估、提取、发现、生成、识别、列举、测量、组织、解析、挑选、预测、提供、排序、推荐、返回、检索、改写、选择、展示、整理、总结、翻译、撰写。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="明确提出需求">明确提出需求<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E6%98%8E%E7%A1%AE%E6%8F%90%E5%87%BA%E9%9C%80%E6%B1%82" class="hash-link" aria-label="明确提出需求的直接链接" title="明确提出需求的直接链接">​</a></h3>
<p>详细说明期望输出。简短的指令可能无法充分引导大语言模型，或过于笼统。在提示中提供具体细节（通过系统或上下文提示）有助于模型聚焦相关内容，提高整体准确性。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="优先使用指令而非约束">优先使用指令而非约束<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4%E8%80%8C%E9%9D%9E%E7%BA%A6%E6%9D%9F" class="hash-link" aria-label="优先使用指令而非约束的直接链接" title="优先使用指令而非约束的直接链接">​</a></h3>
<p>提示中使用的指令和约束用于引导大语言模型的输出。</p>
<p>尽可能使用正向指令：用“应该做什么”替代“禁止做什么”，这能避免混淆并提高输出准确性。</p>
<p>约束条件在特定场景仍具价值：当需要防止模型生成有害/偏见内容，或要求严格输出格式时。</p>
<p>作为最佳实践，应优先处理指令，明确说明您希望模型执行的操作，仅在出于安全性、清晰度或特定需求时使用约束条件。通过实验与迭代测试不同指令和约束的组合，以找到最适合您特定任务的方案，并予以记录。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="控制最大令牌长度">控制最大令牌长度<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E6%8E%A7%E5%88%B6%E6%9C%80%E5%A4%A7%E4%BB%A4%E7%89%8C%E9%95%BF%E5%BA%A6" class="hash-link" aria-label="控制最大令牌长度的直接链接" title="控制最大令牌长度的直接链接">​</a></h3>
<p>要控制生成式大语言模型(LLM)的响应长度，您可以在配置中设置最大令牌限制，或在提示词中明确指定所需长度。例如：</p>
<blockquote>
<p>"Explain quantum physics in a tweet length message."</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="在提示词中使用变量">在提示词中使用变量<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E5%9C%A8%E6%8F%90%E7%A4%BA%E8%AF%8D%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F" class="hash-link" aria-label="在提示词中使用变量的直接链接" title="在提示词中使用变量的直接链接">​</a></h3>
<p>为了实现提示词复用并增强动态性，可在提示词中使用变量，这些变量可根据不同输入进行替换。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img18@main/2025/04/23/1745397189984-9bd0b762-1421-404a-bbbf-2636a357c048.png" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="尝试不同的输入格式与写作风格">尝试不同的输入格式与写作风格<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E5%B0%9D%E8%AF%95%E4%B8%8D%E5%90%8C%E7%9A%84%E8%BE%93%E5%85%A5%E6%A0%BC%E5%BC%8F%E4%B8%8E%E5%86%99%E4%BD%9C%E9%A3%8E%E6%A0%BC" class="hash-link" aria-label="尝试不同的输入格式与写作风格的直接链接" title="尝试不同的输入格式与写作风格的直接链接">​</a></h3>
<p>不同模型、配置、提示格式、措辞和提交方式会产生不同结果。因此需对提示属性进行实验，如风格、措辞及提示类型（零样本、少样本、系统提示） 。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="分类任务的小样本提示中需混合不同类别">分类任务的小样本提示中，需混合不同类别<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%B0%8F%E6%A0%B7%E6%9C%AC%E6%8F%90%E7%A4%BA%E4%B8%AD%E9%9C%80%E6%B7%B7%E5%90%88%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%88%AB" class="hash-link" aria-label="分类任务的小样本提示中，需混合不同类别的直接链接" title="分类任务的小样本提示中，需混合不同类别的直接链接">​</a></h3>
<p>一般而言，小样本示例的顺序影响不大。但在执行分类任务时，务必在少量示例中混合可能的响应类别。这是因为固定顺序可能导致模型对示例顺序产生过拟合。通过混合响应类别，可确保模型学会识别各类别的关键特征，而非简单记忆示例顺序。这种方法能提升模型在未见数据上的鲁棒性和泛化性能。</p>
<p>经验法则建议从6个少量示例开始，并由此测试准确度。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="适应模型更新">适应模型更新<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E9%80%82%E5%BA%94%E6%A8%A1%E5%9E%8B%E6%9B%B4%E6%96%B0" class="hash-link" aria-label="适应模型更新的直接链接" title="适应模型更新的直接链接">​</a></h3>
<p>紧跟模型更新，尝试新版模型调整提示词充分利用新特性。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="尝试不同输出格式">尝试不同输出格式<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E5%B0%9D%E8%AF%95%E4%B8%8D%E5%90%8C%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F" class="hash-link" aria-label="尝试不同输出格式的直接链接" title="尝试不同输出格式的直接链接">​</a></h3>
<p>除输入格式外，还可探索输出格式。对于数据提取、筛选、解析、排序、分级或分类等非创造性任务，建议采用JSON或XML等结构化格式返回结果。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="json-修复">JSON 修复<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#json-%E4%BF%AE%EF%BF%BD%E5%A4%8D" class="hash-link" aria-label="JSON 修复的直接链接" title="JSON 修复的直接链接">​</a></h3>
<p>JSON 格式校验严格，可以使用 PyPI 的 json-repair 智能修复 JSON 格式。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用-schema">使用 Schema<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E4%BD%BF%E7%94%A8-schema" class="hash-link" aria-label="使用 Schema的直接链接" title="使用 Schema的直接链接">​</a></h3>
<p>输入数据也可以使用 JSON 格式高效的组织数据。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="与其他提示工程师协同实验">与其他提示工程师协同实验<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%8F%90%E7%A4%BA%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%8D%8F%E5%90%8C%E5%AE%9E%E9%AA%8C" class="hash-link" aria-label="与其他提示工程师协同实验的直接链接" title="与其他提示工程师协同实验的直接链接">​</a></h3>
<p>当每个人都遵循本章所述的最佳实践时，您将观察到不同提示方案间的性能差异。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="思维链最佳实践">思维链最佳实践<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E6%80%9D%E7%BB%B4%E9%93%BE%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" class="hash-link" aria-label="思维链最佳实践的直接链接" title="思维链最佳实践的直接链接">​</a></h3>
<p>进行思维链提示时，必须将答案置于推理过程之后，因为推理过程的生成会改变模型预测最终答案时所获得的标记（token）。</p>
<p>使用思维链与自洽性方法时，需确保能从提示中分离出最终答案，使其独立于推理过程。</p>
<p>思维链提示的温度参数应设为0。</p>
<p>思维链提示基于贪婪解码机制，即语言模型根据概率最高中的下一个词。一般而言，当涉及推理得出最终答案时，通常存在唯一正确答案，因此温度参数应始终设置为0。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="记录不同提示尝试方案">记录不同提示尝试方案<a href="https://sleepy-zone.github.io/blog/2025-04-24-google-promtps-2.md#%E8%AE%B0%E5%BD%95%E4%B8%8D%E5%90%8C%E6%8F%90%E7%A4%BA%E5%B0%9D%E8%AF%95%E6%96%B9%E6%A1%88" class="hash-link" aria-label="记录不同提示尝试方案的直接链接" title="记录不同提示尝试方案的直接�链接">​</a></h3>
<p>细记录每次提示尝试的完整细节，这样才能逐步总结出哪些方法有效，哪些无效。</p>
<p>提示工程是一个迭代过程。设计并测试不同提示方案，分析记录结果，根据模型表现优化提示词。持续实验直至获得理想输出。当更换模型或调整模型配置时，需重新用先前提示词进行实验验证。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img18@main/2025/04/23/1745397833321-0027f4c9-b523-4ff8-8f3b-724c8d363e88.png" alt="" class="img_ev3q"></p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[谷歌提示词工程 - 模型原理和提示词技术]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md"/>
        <updated>2025-04-23T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[谷歌前段时间发布了提示词工程白皮书，已经有很多博主推荐了，最近终于有时间阅读一下。以下是笔记记录。]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img6@main/2025/04/23/1745392049583-b2db7b1e-2f2b-4565-8252-14f946e00719.png" alt="" class="img_ev3q"></p>
<p>谷歌前段时间发布了提示词工程白皮书，已经有很多博主推荐了，最近终于有时间阅读一下。以下是笔记记录。</p>
<p>原文：<a href="https://drive.google.com/file/d/1AbaBYbEa_EbPelsT40-vj64L-2IwUJHy/view?pli=1" target="_blank" rel="noopener noreferrer">https://drive.google.com/file/d/1AbaBYbEa_EbPelsT40-vj64L-2IwUJHy/view?pli=1</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型工作原理">模型工作原理<a href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md#%E6%A8%A1%E5%9E%8B%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" class="hash-link" aria-label="模型工作原理的直接链接" title="模型工作原理的直接链接">​</a></h3>
<p>大语言模型的本质是<strong>预测</strong>。模型接受输入文本，根据训练数据循环预测后续的文本。提示词就是在引导模型正确的预测。</p>
<p>另外需要了解模型的输出配置，如果你调用过大模型的 API 应该对这些参数比较熟悉。</p>
<p><strong>Output length</strong>：输出长度限制对于大模型的性能，响应时间尤为重要。</p>
<p><strong>Sampling controls</strong>：控制预测结果</p>
<p>Temperature，越高则输出结果越发散，越低则结果更具有确定性。top-K 和 top-P 和 Temperature 类似，值越高，则输出结果越具有创造性和多样性。越高。</p>
<p>文档中给出了几个场景的配置样例：</p>
<ol>
<li>Temperature 值 0.2、top-P 值 0.95 和 top-K 值 30 的组合能产生相对连贯且适度创新的结果。</li>
<li>若追求更高创造性，可 Temperature 值 0.9、top-P 值 0.99 和 top-K 值40 的配置。</li>
<li>如需更保守的输出，建议采用 Temperature 值 0.1、top-P 值0.9 和 top-K值 20 的参数。</li>
<li>对于存在唯一正确答案的任务（如数学题求解） ，应将 Temperature 值设为 0。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="提示词技术">提示词技术<a href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md#%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%8A%80%E6%9C%AF" class="hash-link" aria-label="提示词技术的直接链接" title="提示词技术的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="零样本zero-shot">零样本（zero shot）<a href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md#%E9%9B%B6%E6%A0%B7%E6%9C%ACzero-shot" class="hash-link" aria-label="零样本（zero shot）的直接链接" title="零样本（zero shot）的直接链接">​</a></h4>
<p>零样本仅提供任务描述和供大语言模型处理的文本。不过可以通过增加单个示例（<strong>单样本</strong>）或者多个示例（<strong>少样本</strong>）让模型输出更符合要求的内容。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="系统提示system-prompting">系统提示（System Prompting）<a href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md#%E7%B3%BB%E7%BB%9F%E6%8F%90%E7%A4%BAsystem-prompting" class="hash-link" aria-label="系统提示（System Prompting）的直接链接" title="系统提示（System Prompting）的直接链接">​</a></h4>
<p>系统提示设定语言模型的整体语境和目的，明确模型应执行的宏观任务，如语言翻译、评论分类等。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="角色提示role-prompting">角色提示（Role prompting）<a href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md#%E8%A7%92%E8%89%B2%E6%8F%90%E7%A4%BArole-prompting" class="hash-link" aria-label="角色提示（Role prompting）的直接链接" title="角色提示（Role prompting）的直接链接">​</a></h4>
<p>给模型分配特根据定角色，使模型能角色定位生成更相关、信息量更大的输出。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="情境提示contextual-prompting">情境提示（Contextual prompting）<a href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md#%E6%83%85%E5%A2%83%E6%8F%90%E7%A4%BAcontextual-prompting" class="hash-link" aria-label="情境提示（Contextual prompting）的直接链接" title="情境提示（Contextual prompting）的直接链接">​</a></h4>
<p>给模型提供上下文提示，比如：</p>
<blockquote>
<p>背景：您正在为一家关于80年代复古街机游戏的博客撰稿。请建议3个文章主题，并附上简要说明每篇文章应包含的内容。</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="回退式提示step-back-prompting">回退式提示（Step-back prompting）<a href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md#%E5%9B%9E%E9%80%80%E5%BC%8F%E6%8F%90%E7%A4%BAstep-back-prompting" class="hash-link" aria-label="回退式提示（Step-back prompting）的直接链接" title="回退式提示（Step-back prompting）的直接链接">​</a></h4>
<p>回退式提示法是一种通过让大语言模型先思考与当前具体任务相关的宏观问题，再将宏观问题的答案作为后续具体任务提示的输入，从而提升模型表现的技术。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="思维链chain-of-thoughtcot">思维链（Chain of Thought，CoT）<a href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md#%E6%80%9D%E7%BB%B4%E9%93%BEchain-of-thoughtcot" class="hash-link" aria-label="思维链（Chain of Thought，CoT）的直接链接" title="思维链（Chain of Thought，CoT）的直接链接">​</a></h4>
<p>思维链一种通过生成中间推理步骤来提升大语言模型推理能力的技术。思维链特别适合代码生成时，分解需求逐步输出代码的过程。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="思维树tree-of-thoughtstot">思维树（Tree of Thoughts，ToT）<a href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md#%E6%80%9D%E7%BB%B4%E6%A0%91tree-of-thoughtstot" class="hash-link" aria-label="思维树（Tree of Thoughts，ToT）的直接链接" title="思维树（Tree of Thoughts，ToT）的直接链接">​</a></h4>
<p>思维树允许大语言模型同时探索多条不同的推理路径，而非仅遵循单一线性思维链。适合探索复杂任务。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="推理与行动reactreason--act">推理与行动（ReAct，reason &amp; act）<a href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md#%E6%8E%A8%E7%90%86%E4%B8%8E%E8%A1%8C%E5%8A%A8reactreason--act" class="hash-link" aria-label="推理与行动（ReAct，reason &amp; act）的直接链接" title="推理与行动（ReAct，reason &amp; act）的直接链接">​</a></h4>
<p>大模型基于自然语言推理和外部工具（搜索、代码解释器等）来解决复杂任务。只是实现智能体（Agent）第一步。这部分需要有编写代码的能力，或者借助其他智能体构建工具。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="其他">其他<a href="https://sleepy-zone.github.io/blog/2025-04-23-google-promtps.md#%E5%85%B6%E4%BB%96" class="hash-link" aria-label="其他的直接链接" title="其他的直接链接">​</a></h4>
<p>可以借助大模型优化提示词。</p>
<p>文档还专门提到了代码相关的提示，编写脚本、解释代码、调试、Review等等。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[盘点前端还在更新的老项目]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-04-21-old-fe-1.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-04-21-old-fe-1.md"/>
        <updated>2025-04-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[今天不聊 AI，聊点前端。冒着暴露年龄的风险聊点前端里还在更新的老项目。]]></summary>
        <content type="html"><![CDATA[<p>今天不聊 AI，聊点前端。冒着暴露年龄的风险聊点前端里还在更新的老项目。</p>
<p>（其实 React、Vue 这些库也算老项目了，不过不再我们讨论之列，主要讨论那些我们平时基本见不到但一直更新的项目）</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jquery">jQuery<a href="https://sleepy-zone.github.io/blog/2025-04-21-old-fe-1.md#jquery" class="hash-link" aria-label="jQuery的直接链接" title="jQuery的直接链接">​</a></h3>
<p>jQuery 算是老项目里的代表里，他的 <code>$</code> 语法可以说是别具一格，在那个需要浏览器兼容的年代独树一帜。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ajax</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/api/getWeather"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">zipcode</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">97201</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">success</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token parameter">result</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">$</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"#weather-temp"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">html</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"&lt;strong&gt;"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"&lt;/strong&gt; degrees"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> hiddenBox </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">$</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"#banner-message"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">$</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"#button-container button"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"click"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token parameter">event</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hiddenBox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Github 上看了一下 2022 年就已经开始着手准备 4.0 版本了（<a href="https://github.com/jquery/jquery/milestone/7%EF%BC%89%E3%80%82" target="_blank" rel="noopener noreferrer">https://github.com/jquery/jquery/milestone/7）。</a></p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img12@main/2025/04/21/1745215856167-0f66a243-84a9-4b9c-90ac-7ece5e2c38ad.png" alt="" class="img_ev3q"></p>
<p><a href="https://jquery.com/" target="_blank" rel="noopener noreferrer">官网</a>表示 4.0 版本即将发布了：</p>
<blockquote>
<p>jQuery 4.0 is coming soon! Prepare by upgrading to the latest jQuery 3.x release. Learn more about our version support.</p>
</blockquote>
<p>另一个与之相似的项目 <a href="https://zeptojs.com/" target="_blank" rel="noopener noreferrer">zepto.js</a> 不知道大家有没有听说过，作为当时在 mobile 项目上的替代品。目前看 Github 已经留在 6 年前了。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gulp">Gulp<a href="https://sleepy-zone.github.io/blog/2025-04-21-old-fe-1.md#gulp" class="hash-link" aria-label="Gulp的直接链接" title="Gulp的直接链接">​</a></h3>
<p>在还没有 Webpack 的年代，<a href="https://gulpjs.com/" target="_blank" rel="noopener noreferrer">Gulp</a> 是我认为最好用的自动化构建工具了。流式或者并行的将构建任务串联起来，而且支持插件扩展。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img12@main/2025/04/21/1745216667840-037ba719-c87e-4de2-8baa-b86b07504351.png" alt="" class="img_ev3q"></p>
<p>去年 3 月（2024/3/29），<a href="https://medium.com/gulpjs/announcing-gulp-v5-c67d077dbdb7" target="_blank" rel="noopener noreferrer">Gulp 5 正式发布</a>。</p>
<blockquote>
<p>Gulp 5 的发布之路漫长，但我们终于来了！此版本凝聚了 60 多个项目四年的心血。团队一共解决了 200 多个问题和 Pull Request。🤯</p>
</blockquote>
<p>Gulp 之前还有一个类似的项目：<a href="https://gruntjs.com/" target="_blank" rel="noopener noreferrer">Grunt</a>，不过最后更新时间停留在了 2021 年。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fabricjs">fabric.js<a href="https://sleepy-zone.github.io/blog/2025-04-21-old-fe-1.md#fabricjs" class="hash-link" aria-label="fabric.js的直接链接" title="fabric.js的直接链接">​</a></h3>
<p><a href="https://fabricjs.com/docs/" target="_blank" rel="noopener noreferrer">fabric.js</a> 是一个 Canvas 2D 操作库，把操作 Canvas 变的和操作 JS Object 一样简单。</p>
<p>虽然很好用，但代码依然是 ES5 时代，代码库里很多 Object.prototype，还有一些 polyfill code。不过终于去年发布了 v6 大版本，支持了 TypeScript。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img9@main/2025/04/21/1745217332670-feb3786f-71d6-4a97-a8b4-58f82f690f41.png" alt="" class="img_ev3q"></p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> React</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> useEffect</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> useRef </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'react'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> fabric </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'fabric'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// v6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> fabric </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'fabric'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// v5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">FabricJSCanvas</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> canvasEl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">useRef</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">HTMLCanvasElement</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> canvas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">fabric</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Canvas</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">canvasEl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// make the fabric.Canvas instance available to your app</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">updateCanvasContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">canvas</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">updateCanvasContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">canvas width</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"300"</span><span class="token plain"> height</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"300"</span><span class="token plain"> ref</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">canvasEl</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我的 <a href="https://github.com/sleepy-zone/fabritor-web" target="_blank" rel="noopener noreferrer">fabritor</a> 就是基于 fabric.js 构建的，后面也计划升级到 6.0 版本。</p>
<hr>
<p>今天先更新到这里，你还知道哪些老项目已经在坚持更新？</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="frontend" term="frontend"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[从 Github 不能访问想到的]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-04-14-github-no-vistit.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-04-14-github-no-vistit.md"/>
        <updated>2025-04-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[上周末中国未登录用户无法访问 Github，瞬间在社交媒体引起轩然大波。]]></summary>
        <content type="html"><![CDATA[<p>上周末中国未登录用户无法访问 Github，瞬间在社交媒体引起轩然大波。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img7@main/2025/04/14/1744620520993-54adfc65-507b-439a-924b-a5e91ee9353d.png" alt="" class="img_ev3q"></p>
<p>有人玩梗😂：</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img12@main/2025/04/14/1744620550287-2096f2d6-3fbe-410b-aa43-c448dc927077.png" alt="" class="img_ev3q"></p>
<p>有人焦虑，虽然之前已经有地方无法正常访问 Github，但原因心知肚明。这次疑似 Github 主动屏蔽中国 IP，和 OpenAI 类似，不免让人怀疑，难道最近的大国博弈开始影响 Github？</p>
<p>有人表示问题不大，毕竟哪个程序员不用魔法上网？</p>
<p>有人开始想退路，是不是可以备份开源项目了，一旦无法访问，而又没有备份，想想就心痛。</p>
<p>不过最后 Github 发布公告是因为配置变更导致这个问题（<a href="https://www.githubstatus.com/incidents/jfvgcls9swln%EF%BC%89%EF%BC%9A" target="_blank" rel="noopener noreferrer">https://www.githubstatus.com/incidents/jfvgcls9swln）：</a></p>
<blockquote>
<p>由于配置变更造成了意外影响，未登录的用户从中国访问 GitHub.com 时暂时无法访问。已登录的用户仍可继续访问。影响于 2025 年 4 月 12 日 20:01 UTC 开始。影响已于 2025 年 4 月 13 日 14:55 UTC 缓解。导致此影响的配置更改已被撤销，用户在尝试访问 GitHub.com 时应该不会再遇到问题。</p>
</blockquote>
<p>（不得不感慨老外是松弛，搁国内 p0 故障加 325 起步😭）</p>
<hr>
<p>事情就是这么个事情，看起来像一场闹剧，国内开发者讨论了半天猜了半天，最后以一个公告结束。</p>
<p>其实我想说的是，国内的开发者过的确实太苦了。</p>
<p>想获得信息，全是英文文档，虽然现在 AI 大大降低了阅读的门槛。</p>
<p>而 AI ，像  OpenAI、Anthropic 都是主动屏蔽中国 IP 的，所以需要掌握一定的上网技巧，躲避两边的网络限制。</p>
<p>而现在内外的环境又充满了不确定性。不论是打工还是独立开发都是困难重重。</p>
<p>所以 Github 一点点的网络波动就影响了千千万万的国内开发者。</p>
<p>就目前来看，也很难寄希望于国内能出现 Github 同级别的服务，出现了大概率也会有很多奇奇怪怪的骚操作。</p>
<p>以上。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="talk" term="talk"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[什么是 Agent]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-04-10-what-is-agent.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-04-10-what-is-agent.md"/>
        <updated>2025-04-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[https://weaviate.io/blog/what-are-agentic-workflows]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img19@main/2025/04/08/1744079884466-358dff04-5fa3-4083-a002-984f7c38faab.png" alt="https://weaviate.io/blog/what-are-agentic-workflows" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="�火爆的-agent">火爆的 Agent<a href="https://sleepy-zone.github.io/blog/2025-04-10-what-is-agent.md#%E7%81%AB%E7%88%86%E7%9A%84-agent" class="hash-link" aria-label="火爆的 Agent的直接链接" title="火爆的 Agent的直接链接">​</a></h3>
<p>AI Agent 应该是 AI 出现后讨论最多的一个词了，因为他代表着 AI 应用的最高层次了，从上次 Manus 的火爆就可见一斑。AI 给人的感觉无所不能又高深莫测，普通人又充满好奇但只能敬而远之，那是到底什么才是 AI Agent？</p>
<p>通常很多文章在讲解 AI Agent 时又会引入很多新的概念和名词，这就让 AI Agent 的概念更加难以理解。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="我的理解">我的理解<a href="https://sleepy-zone.github.io/blog/2025-04-10-what-is-agent.md#%E6%88%91%E7%9A%84%E7%90%86%E8%A7%A3" class="hash-link" aria-label="我的理解的直接链接" title="我的理解的直接链接">​</a></h3>
<p>我们可以换个角度看，AI Agent 的最终形态就是可以和人一样处理任务，那如果直接把 Agent 看做人类，一切就变得非常容易理解。</p>
<p>想象一下，作为前端，我要完成一个后台管理页面的需求，我是怎么做的：</p>
<ul>
<li>首先我有了一定的知识储备，了解基本的前端知识和一些框架，比如 React。</li>
<li>因为是公司内部项目，所以我还需要去了解内部的组件库。</li>
<li>分析需求，确定组件划分。</li>
<li>开始编码，遇到问题需要联网查阅资料。</li>
<li>测试阶段，排查问题，修复问题。</li>
</ul>
<p>此时，如果需要 AI 完成这个事情，同样也是按照上述步骤：</p>
<ul>
<li>目前大模型都是基于已有数据进行预训练，那么模型已经具备了前端知识和框架。</li>
<li>但模型无法知晓公司内部组件库，所以先让他进行学习。这就是 RAG。</li>
</ul>
<blockquote>
<p>检索增强生成（RAG）旨在通过检索和整合外部知识来增强大语言模型生成
文本的准确性和丰富性，其是一个集成了外部知识库、信息检索器、大语言模型等
多个功能模块的系统。RAG 利用信息检索、深度学习等多种技术为大语言模型在
生成过程中引入最新的、特定领域的知识，从而克服传统大语言模型的局限性，提
供更加精准和可靠的生成内容。（引用自：<a href="https://github.com/ZJU-LLMs/Foundations-of-LLMs%EF%BC%89" target="_blank" rel="noopener noreferrer">https://github.com/ZJU-LLMs/Foundations-of-LLMs）</a></p>
</blockquote>
<ul>
<li>AI 根据需求（Prompt），基于学习的知识进行拆分组件、编写代码（规划步骤 WorkFlow）。</li>
<li>遇到问题，联网排查资料（使用 Tool）</li>
<li>测试阶段，遇到问题，进行修复。（基于上下文记忆 Memery）。</li>
</ul>
<p>可以看出 AI Agent 做事情的方式就是在无限的接近于人类的做事方式：有知识储备，有规步骤规划，有工作流，有工具，最终输出结果。而整个流程中，AI Agent 作为一个完备的系统（没错，AI Agent 是一个系统），内部各部分有条不紊的工作。这一点和人类也一样，人类是一个完美的系统！</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://sleepy-zone.github.io/blog/2025-04-10-what-is-agent.md#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接">​</a></h3>
<p><strong>最后我们总结一下什么是 Agent：</strong></p>
<ol>
<li>首先是基于大模型的，这是基础。</li>
<li>感知外部环境：和用户、外部知识、工具甚至是其他 Agent 交互。</li>
<li>规划和决策：任务管理、任务分配、多步骤工作。</li>
<li>记忆和改进：理解上下文。</li>
<li>结合以上几点：<strong>AI Agent 是一个可以理解上下文，通过感知外部环境变化，对任务进行分析、规划并最终进行决策的系统。</strong></li>
</ol>
<p>目前已经有很多细分领域的 Agent 了，比如大火的 Cursor，生成代码建议、代码生成、询问人类意见，通过更多的案例学习，后续的编码 Agent 会变的更加智能。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img10@main/2025/04/08/1744082199745-c25ab9f1-182f-4f10-9046-250043f1a8de.png" alt="" class="img_ev3q"></p>
<hr>
<p>本文只是个人对 AI Agent 的简单理解，对于详细的定义概念和分类，还是要参考资料和专业书籍，推荐文章 <a href="https://weaviate.io/blog/what-are-agentic-workflows%E3%80%82%E5%8F%A6%E5%A4%96%E5%A6%82%E6%9E%9C%E6%83%B3%E8%A6%81%E5%8A%A8%E6%89%8B%E5%AE%9E%E8%B7%B5%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E4%B8%80%E4%B8%8B%E5%BE%AE%E8%BD%AF%E7%9A%84" target="_blank" rel="noopener noreferrer">https://weaviate.io/blog/what-are-agentic-workflows。另外如果想要动手实践，可以看一下微软的</a> AI Agent 课程：<a href="https://microsoft.github.io/ai-agents-for-beginners/%E3%80%82" target="_blank" rel="noopener noreferrer">https://microsoft.github.io/ai-agents-for-beginners/。</a></p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[DeepSite：基于 DeepSeek 的生码应用]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-04-07-deepsite.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-04-07-deepsite.md"/>
        <updated>2025-04-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[试用一下]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img2@main/2025/04/03/1743689667074-2a6cb109-602f-4f30-a651-d22c7a38d4d7.png" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="试用一下">试用一下<a href="https://sleepy-zone.github.io/blog/2025-04-07-deepsite.md#%E8%AF%95%E7%94%A8%E4%B8%80%E4%B8%8B" class="hash-link" aria-label="试用一下的直接链接" title="试用一下的直接链接">​</a></h2>
<p>最近看到很多人都在聊一个 DeepSite 的应用，应用部署在 huggingface：<a href="https://sleepy-zone.github.io/blog/[https://huggingface.co/spaces/enzostvs/deepsite">https://huggingface.co/spaces/enzostvs/deepsite</a>，功能很简单直接：<strong>基于 DeepSeek 一键生成纯 html 应用并且可以发布至 huggingface space</strong>。</p>
<p>我试了一下，让 DeepSite 生成一个炫酷的个人博客首页。</p>
<p>整体效果很不错，页面完整，效果炫酷，我已经部署到我的 space ：<a href="https://huggingface.co/spaces/sleepy-zone/sleepyspace" target="_blank" rel="noopener noreferrer">https://huggingface.co/spaces/sleepy-zone/sleepyspace</a>：</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img14@main/2025/04/03/1743689804286-948a8e55-46f1-4596-87a7-ac36674adf94.png" alt="" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img10@main/2025/04/03/1743689839587-712dad61-7489-4ed7-94b5-69d25a98560f.png" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="看看代码">看看代码<a href="https://sleepy-zone.github.io/blog/2025-04-07-deepsite.md#%E7%9C%8B%E7%9C%8B%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="看看代码的直接链接" title="看看代码的直接链接">​</a></h2>
<p>代码位于：<a href="https://huggingface.co/spaces/enzostvs/deepsite/tree/main" target="_blank" rel="noopener noreferrer">https://huggingface.co/spaces/enzostvs/deepsite/tree/main</a>。</p>
<p>DeepSeek 生码的逻辑位于 <code>server.js</code>：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> chatCompletion </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">chatCompletionStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">model</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MODEL_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">provider</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> selectedProvider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">messages</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">role</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"system"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">ONLY USE HTML, CSS AND JAVASCRIPT. If you want to use ICON make sure to import the library first. Try to create the best UI possible by using only HTML, CSS and JAVASCRIPT. Use as much as you can TailwindCSS for the CSS, if you can't do something with TailwindCSS, then use custom CSS (make sure to import &lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt; in the head). Also, try to ellaborate as much as you can, to create something unique. ALWAYS GIVE THE RESPONSE INTO A SINGLE HTML FILE</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">previousPrompt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">role</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"user"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> previousPrompt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">role</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"assistant"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">The current code is: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">html</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">.</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">role</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"user"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> prompt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selectedProvider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"sambanova"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">max_tokens</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> selectedProvider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">max_tokens</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>prompt 也很简洁：仅使用 HTML、CSS 和 JavaScript。如果您想使用图标，请确保首先导入库。尽量仅使用 HTML、CSS 和 JavaScript 创建最好的 UI。尽可能多地使用 TailwindCSS 进行样式设计，如果无法使用 TailwindCSS 完成某些样式，则使用自定义 CSS（确保在中导入 <script src="https://cdn.tailwindcss.com"></script>）。此外，尽量详细 elaboration，以创建一些独特的东西。始终将响应提供为单个 HTML 文件。</p>
<p>其他都是前端代码，目前看自己部署一个成本也不是很高。喜欢折腾的朋友可以玩一下看。</p>
<hr>
<p><strong>最后感叹一下，现在模型的能力突飞猛进。而模型能力跟上之后，应用的创意和交互体验就显得尤为重要。</strong></p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[最近几件关于 AI 的事情]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-04-06-recent-ai-1.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-04-06-recent-ai-1.md"/>
        <updated>2025-04-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[AI 公司貌似喜欢在中国的节假日搞动作，清明节短短三天假期就有很多猛料。]]></summary>
        <content type="html"><![CDATA[<p>AI 公司貌似喜欢在中国的节假日搞动作，清明节短短三天假期就有很多猛料。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="github-官方-mcp-server-发布">Github 官方 MCP Server 发布<a href="https://sleepy-zone.github.io/blog/2025-04-06-recent-ai-1.md#github-%E5%AE%98%E6%96%B9-mcp-server-%E5%8F%91%E5%B8%83" class="hash-link" aria-label="Github 官方 MCP Server 发布的直接链接" title="Github 官方 MCP Server 发布的直接链接">​</a></h3>
<p>github 博客链接：<a href="https://github.blog/changelog/2025-04-04-github-mcp-server-public-preview/" target="_blank" rel="noopener noreferrer">https://github.blog/changelog/2025-04-04-github-mcp-server-public-preview/</a></p>
<p>官方仓库：<a href="https://github.com/github/github-mcp-server" target="_blank" rel="noopener noreferrer">https://github.com/github/github-mcp-server</a></p>
<blockquote>
<p>今天，我们发布了一款新的开源官方本地 GitHub MCP 服务器。我们与 Anthropic 合作，用 Go 重写了他们的参考服务器，并提高了其可用性。新服务器包含旧服务器的 100% 功能，此外还能够自定义工具描述、支持代码扫描，并新增了 get_me 函数，该函数可改善自然语言用户体验，例如询问“显示我的私人存储库”。</p>
</blockquote>
<p>今天又看到一则消息，后面的模型将不再支持 Tool。还是那句话，持续看好 MCP！</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="meta-llama-4-发布">Meta Llama 4 发布<a href="https://sleepy-zone.github.io/blog/2025-04-06-recent-ai-1.md#meta-llama-4-%E5%8F%91%E5%B8%83" class="hash-link" aria-label="Meta Llama 4 发布的直接链接" title="Meta Llama 4 发布的直接链接">​</a></h3>
<p>Meta Llama 4 发布，号称最强模型。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img15@main/2025/04/07/1744010657941-7ee3dfba-f310-4066-990d-d17e243cb690.png" alt="" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img9@main/2025/04/07/1744010677516-35f65be4-fccb-4cb0-99db-bf589f3f2e6f.png" alt="" class="img_ev3q"></p>
<p>不过社区评价看起来好像不怎么好，虽然有超大的上下文窗口，但体验一般，知乎的讨论也是一边倒的看衰：<a href="https://www.zhihu.com/question/1892067881098903620" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/1892067881098903620</a></p>
<p>另外，Qwen、DeepSeek R2 据说也快发布了，还是期待国内的模型吧。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="openrouter-发布-quasar-alpha">OpenRouter 发布 Quasar Alpha<a href="https://sleepy-zone.github.io/blog/2025-04-06-recent-ai-1.md#openrouter-%E5%8F%91%E5%B8%83-quasar-alpha" class="hash-link" aria-label="OpenRouter 发布 Quasar Alpha的直接链接" title="OpenRouter 发布 Quasar Alpha的直接链接">​</a></h3>
<p>OpenRouter（<a href="https://openrouter.ai/%EF%BC%89%EF%BC%8C%E6%98%AF%E4%B8%80%E4%B8%AA%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%95%86%EF%BC%8C%E4%BB%96%E4%BB%AC%E4%B9%9F%E5%8F%91%E5%B8%83%E4%BA%86%E8%87%AA%E5%AE%B6%E6%A8%A1%E5%9E%8B%EF%BC%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E8%BE%BE%E5%88%B0" target="_blank" rel="noopener noreferrer">https://openrouter.ai/），是一个模型服务商，他们也发布了自家模型，上下文达到</a> 1m，特别适合代码，并且免费！</p>
<blockquote>
<p>This is a cloaked model provided to the community to gather feedback. It’s a powerful, all-purpose model supporting long-context tasks, including code generation. All prompts and completions for this model are logged by the provider as well as OpenRouter.</p>
</blockquote>
<blockquote>
<p>这是提供给社区以收集反馈的隐藏模型。这是一个功能强大的通用模型，支持长上下文任务，包括代码生成。此模型的所有提示和完成都由提供商和 OpenRouter 记录。</p>
</blockquote>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[MCP - AI 和真实世界的桥梁]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-03-28-mcp.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-03-28-mcp.md"/>
        <updated>2025-03-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[在上篇文章 动手开发一个 MCP Server 中讲了怎么开发一个 MCP Server，本文简单聊聊我对 MCP 的看法。]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img2@main/2025/03/28/1743149448198-f539c9a9-db7e-48c8-a8a4-8791aab4309b.png" alt="" class="img_ev3q"></p>
<p>在上篇文章 <a href="https://mp.weixin.qq.com/s/EedUriN_nMWIoZgJAZP6dQ" target="_blank" rel="noopener noreferrer">动手开发一个 MCP Server</a> 中讲了怎么开发一个 MCP Server，本文简单聊聊我对 MCP 的看法。</p>
<p>一直以来，我认为大模型工具的最终形态就是一个<strong>输入框</strong>。用户的任何需求，不论是写文章查资料写代码，还是旅游攻略订酒店，都只需求在输入框内输入需求，AI 会自动找到合适的工具去解决问题并最后进行反馈。</p>
<p>听起来非常的 <strong>Agent</strong>。</p>
<p>AI 擅长自然语言理解，擅长知识输出，擅长内容总结，而自动找到合适的工具，这是一个很大的挑战。</p>
<p>当前 AI 能自动找到合适的工具的前提是我们需要给 AI 提供足够多的工具，而大多数时候我们只能依赖使用的 AI App，比如 App 提供了联网功能，我们才可以使用联网搜索，但当我们希望使用一个操作本地文件的工具，只能等待 AI App 内置，或者自行开发；当我们因为工作环境切换，使用新的 AI app 时，一切可能都变了，要么没有对应的工具，要么不兼容，只能从头开始适配。</p>
<p>MCP 的出现很好的解决了这个问题，他将 AI 和外部数据如何交互进行了约定，保证一个符合 MCP 协议的工具是处处可用的。正因为如此，目前几乎能想到的服务都进行了 MCP 化，甚至高德百度地图都推出了 MCP Server。</p>
<p>对于用户来说，不必为了某个工具局限于某个 AI App 或者 Agent，有了 MCP 用户通过自由的组合 MCP Server 来创建独属于自己的 Agent，一切变得可插拔和模块化，给了用户极大的自由。另外，对于各种各样的外部服务，也不必再去想如何开发 Agent，而是暴露通用的 MCP Server 即可。</p>
<p>不过目前 MCP 并非完美，配置和使用成本对于普通用户来说并不低，并且如果要定制自己的 MCP Server 还需要有开发能力。在社交媒体能看到很多人表示“没有配置成功过”，也表示不如其他的 AI 功能效果来的快。</p>
<p>但我依旧非常看好 MCP，我认为这是 AI 能力扩展上的一个正确而可行的路线，真正可以让 AI 接触到真实世界，从而更好的为人类服务。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[动手开发一个 MCP Server]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-03-26-dev-mcp-server.md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-03-26-dev-mcp-server.md"/>
        <updated>2025-03-26T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[https://blog.bytebytego.com/p/ep154-what-is-mcp]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_lossy/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F840e868d-2c83-4b1b-a881-df1da6c6e332_1309x1536.gif" alt="https://blog.bytebytego.com/p/ep154-what-is-mcp" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mcp-简介">MCP 简介<a href="https://sleepy-zone.github.io/blog/2025-03-26-dev-mcp-server.md#mcp-%E7%AE%80%E4%BB%8B" class="hash-link" aria-label="MCP 简介的直接链接" title="MCP 简介的直接链接">​</a></h2>
<p>MCP，Model Context Protocol，模型上下文协议，是由 Anthropic （Claude 系列模型公司）提出的一种 AI 和外部数据（本地文件、远程 API、数据库以及其他所有你能想到的）交互的协议，以此来增强 AI 的能力。</p>
<p>MCP 遵循客户端-服务器模型，包含 3 个关键组件：</p>
<ol>
<li>Host，AI App，比如我们使用的 Claude App、ChatWise 等。</li>
<li>MCP Client，一般会由 AI App 集成，负责和 MCP Server 通信。</li>
<li>MCP Server，连接外部数据，并将数据返回给 MCP Client。这样 AI App 就可以获取外部数据了。</li>
</ol>
<p>如果你之前了解过 Function Call 或者 Tool（后面两者统一称为 Tool），应该对 MCP 这个概念会感到很熟悉，同样都是扩展 AI 的能力，但 Tool 需要在每个 AI 应用内单独集成无法复用，而 MCP 可以看做是一个更通用的 Tool，不论你使用哪个 AI App，只要 AI App 内置 MCP Client，就可以使用 MCP 市场的 Server。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="动手开发">动手开发<a href="https://sleepy-zone.github.io/blog/2025-03-26-dev-mcp-server.md#%E5%8A%A8%E6%89%8B%E5%BC%80%E5%8F%91" class="hash-link" aria-label="动手开发的直接链接" title="动手开发的直接链接">​</a></h2>
<p>一般来说，AI App 会集成 MCP Client，所以对于使用 AI App 的我们来说，我们唯一需要做的是定制 MCP Server，使我们的工具更加强大。</p>
<p>接下来我们要开发一个获取 Pixabay（<a href="https://pixabay.com/%EF%BC%89%E5%9B%BE%E7%89%87%E7%9A%84" target="_blank" rel="noopener noreferrer">https://pixabay.com/）图片的</a> MCP server。简单起见，我们直接使用 JavaScript。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="开发">开发<a href="https://sleepy-zone.github.io/blog/2025-03-26-dev-mcp-server.md#%E5%BC%80%E5%8F%91" class="hash-link" aria-label="开发的直接链接" title="开发的直接链接">​</a></h3>
<p>首先，创建项目：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Create a new directory for our project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir pixabay-mcp-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd pixabay-mcp-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Initialize a new npm project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm init -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm install @modelcontextprotocol/sdk zod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create our files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">touch index.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>更新一下 package.json，这里设置一下 bin 和文件权限，其实 node 写 MCP Server 和写命令行工具差不多。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"module"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"bin"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"pixabay"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"index.js"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"build"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" chmod 755 index.js"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"files"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"index.js"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>下面开始编写逻辑代码。 <code>@modelcontextprotocol/sdk</code> 这个包来辅助我们编写 MCP Server。</p>
<p>首先定义 server：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">McpServer</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@modelcontextprotocol/sdk/server/mcp.js'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">StdioServerTransport</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@modelcontextprotocol/sdk/server/stdio.js'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> z </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'zod'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> baseUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'https://pixabay.com/api/'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">McpServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'pixabay-mcp-server'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">version</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'1.0.0'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 插入 tool 代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">startServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> transport </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">StdioServerTransport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">transport</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">startServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>下面定义 server 内的 tool（server 由一个个的 tool 组成）。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tool</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">'image-search'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">query</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'all'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> requestUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">baseUrl</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">?key=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">process</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">env</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation constant" style="color:#36acaa">PIXABAY_KEY</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">&amp;q=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">query</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">&amp;image_type=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">type</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requestUrl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> json </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'text'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">text</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">images</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hits</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">total_results</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">total</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'text'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">text</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Error: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">e</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">isError</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="调试">调试<a href="https://sleepy-zone.github.io/blog/2025-03-26-dev-mcp-server.md#%E8%B0%83%E8%AF%95" class="hash-link" aria-label="调试的直接链接" title="调试的直接链接">​</a></h3>
<p>官方提供了一个测试工具，<a href="https://github.com/modelcontextprotocol/inspector%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%89%A7%E8%A1%8C%E4%B8%8B%E9%9D%A2%E7%9A%84%E5%91%BD%E4%BB%A4%E6%B5%8B%E8%AF%95%EF%BC%9A" target="_blank" rel="noopener noreferrer">https://github.com/modelcontextprotocol/inspector，可以执行下面的命令测试：</a></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx @modelcontextprotocol/inspector node index.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>访问 <a href="http://localhost:5173/" target="_blank" rel="noopener noreferrer">http://localhost:5173</a> 调试。如下图，我们可以看到连接成功后，列举出我们定义的 tool，并且可以解析出 tool 需要的参数，我们输入参数后，点击 run tool 获取到数据，就说明成功了！</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img14@main/2025/03/26/1742958541480-37dc5ca2-8787-4f00-8bb3-b7854342c2af.png" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="发布">发布<a href="https://sleepy-zone.github.io/blog/2025-03-26-dev-mcp-server.md#%E5%8F%91%E5%B8%83" class="hash-link" aria-label="发布的直接链接" title="发布的直接链接">​</a></h3>
<p>调试成功后，将上述代码发布到 npm，后面就可以在你喜欢的 AI App 使用你的 MCP sever 了，比如你的包的名字就叫 <code>pixabay-mcp-server</code>，这里以 Cursor 或者 Cline 为例配置：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"mcpServers"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"pixabay-mcp-server"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"command"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"npx"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"args"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"-y"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"pixabay-mcp-server"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"env"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">"PIXABAY"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"xxxxx"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当我们向 AI 提出问题 <code>search cat photos</code>，AI 会识别到需要调用我们的工具，并且准确识别到需要提供的参数：</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img18@main/2025/03/26/1742959168926-840fc544-282b-449f-9c1b-3c0fc963b2cb.png" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="后面">后面<a href="https://sleepy-zone.github.io/blog/2025-03-26-dev-mcp-server.md#%E5%90%8E%E9%9D%A2" class="hash-link" aria-label="后面的直接链接" title="后面的直接链接">​</a></h2>
<p>使用 Node.js 写一个 MCP Server 还是很简单的，可以通过官方文档了解更多：<a href="https://modelcontextprotocol.io/quickstart/server%E3%80%82" target="_blank" rel="noopener noreferrer">https://modelcontextprotocol.io/quickstart/server。</a></p>
<p>MCP Server 大大扩展了我们使用 AI 的边界，下一篇文章简单聊聊我对 MCP 的一点看法。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[woocs，基于 doocs/md 的微信 Markdown 编辑器桌面应用]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-03-21-woocs</id>
        <link href="https://sleepy-zone.github.io/blog/2025-03-21-woocs"/>
        <updated>2025-03-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[前两天推荐了一款微信 Markdown 编辑器：doocs/md，并在文章末尾预告：正在基于该项目开发微信 Markdown 编辑器桌面应用。今天他来了 - woocs，基于 doocs/md 的微信 Markdown 编辑器桌面应用，正式发布了！]]></summary>
        <content type="html"><![CDATA[<p>前两天推荐了一款微信 Markdown 编辑器：doocs/md，并在文章末尾预告：正在基于该项目开发微信 Markdown 编辑器桌面应用。今天他来了 - <strong>woocs</strong>，基于 doocs/md 的微信 Markdown 编辑器桌面应用，正式发布了！</p>
<p>项目地址：<a href="https://github.com/sleepy-zone/woocs%E3%80%82" target="_blank" rel="noopener noreferrer">https://github.com/sleepy-zone/woocs。</a></p>
<p>官网地址：<a href="https://sleepy-zone.github.io/woocs-home/" target="_blank" rel="noopener noreferrer">https://sleepy-zone.github.io/woocs-home/</a></p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img1@main/2025/03/21/1742532066065-adbefcb7-01b4-421e-b466-0ec01e0e7e86.png" alt="woocs home page" class="img_ev3q"></p>
<p>（上面截图是我用 vibe coding 的方式快速上线的官网 😁）</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="关于-woocs">关于 woocs<a href="https://sleepy-zone.github.io/blog/2025-03-21-woocs#%E5%85%B3%E4%BA%8E-woocs" class="hash-link" aria-label="关于 woocs的直接链接" title="关于 woocs的直接链接">​</a></h2>
<p>初次使用 doocs/md 十分惊艳，但作为编辑器，我还是更喜欢使用桌面应用，喜欢将编辑的文本存储在个人目录而不是浏览器的 localStorage 中，这样我即可以将文章存在本地，由于我使用的是 Mac，我还可以将文稿目录设置为 iCloud 同步，在我的其他设备上继续查看和编辑。</p>
<p>很快我基于 electron-vite 就将 doocs/md 封装成为了一个桌面应用，这得益于两者都是 vite 的构建，两者源码、构建配置出奇的契合，关于技术细节不在这里赘述。</p>
<p>woocs 项目主要在保留 doocs/md 原功能的前提下，对其进行了桌面化适配：</p>
<ul>
<li>本地内容管理，从 <code>localStorage</code> 移动至 <code>${用户文档目录}/woocs</code></li>
<li>将新建、设置、导入导出、关于等操作移动至菜单栏，并对常用操作增加快捷键</li>
<li>将原菜单栏和设置的重复项合并至设置面板内</li>
<li>新增工具栏，将格式、上传、表格、内容管理、新建等移动至工具栏</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img4@main/2025/03/21/1742532797887-f80380ba-86a7-46ca-9922-c4704055706b.png" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="写在后面">写在后面<a href="https://sleepy-zone.github.io/blog/2025-03-21-woocs#%E5%86%99%E5%9C%A8%E5%90%8E%E9%9D%A2" class="hash-link" aria-label="写在后面的直接链接" title="写在后面的直接链接">​</a></h2>
<p>本来 woocs 只是作为自己用的一个工具在开发，前两天晚上转了一位博主推荐 doocs/md 的推，并预告了一下自己正在开发基于 doocs/md 的微信 Markdown 编辑器桌面应用，没想到得到巨大的关注。截止目前已经有 2.4w 的曝光，并带来了 40+ 的关注，甚至有手快的小伙伴已经自己打包使用并提交了 pr，这种自己顺手做的事情能帮助很多人的感觉真的很不错。</p>
<p>再次感谢 doocs/md、electron-vite 等优秀的开源项目，因为开源才有了 woocs。最后希望大家用的开心写的开心，如果你也喜欢 woocs，请给个 star 吧😊。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="OpenSource" term="OpenSource"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[聊聊 vibe coding]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-03-20-vibe-coding</id>
        <link href="https://sleepy-zone.github.io/blog/2025-03-20-vibe-coding"/>
        <updated>2025-03-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[vibe coding，中文翻译为氛围编程，初次听这个词一头雾水。这个词由Andrej Karpathy （ OpenAI 联合创始人、前特斯拉 AI 负责人）最早提出：]]></summary>
        <content type="html"><![CDATA[<p>vibe coding，中文翻译为氛围编程，初次听这个词一头雾水。这个词由<a href="https://x.com/karpathy/status/1886192184808149383" target="_blank" rel="noopener noreferrer">Andrej Karpathy</a> （ OpenAI 联合创始人、前特斯拉 AI 负责人）最早提出：</p>
<blockquote>
<p>我最近创造了一种新的编码方式，叫做“氛围编码”。在这种编码中，我完全沉浸在氛围中，接受代码指数级别的变化，甚至忘记代码本身的存在。这是因为大型语言模型（比如结合了 Cursor Composer 和 Sonnet 的工具）越来越强大。此外，我几乎不需要碰键盘，只要通过 SuperWhisper 和 Composer 进行对话。我问一些非常简单的问题，比如“将侧边栏的内边距减少一半”，因为我懒得找相关的代码。我总是选择“接受全部”，也不再查看差异了。当出现错误信息时，我只是简单地复制粘贴这些信息，通常这样就能解决问题。代码的发展超出了我平常的理解，假如想彻底理解它，我得花比较长的时间认真阅读。有时候，LLM（大型语言模型）无法修复某个错误，我就通过变更一些随机的内容或请求其他修改来绕过问题。虽然这样做对随便的周末项目来说还不错，但也非常有趣。我正在构建一个项目或网页应用，但这已经不算真正的编码了——我只是看看、说说、运行和复制粘贴，最后大多数情况下都能正常工作。</p>
</blockquote>
<p>也可以这么说，vibe coding 是一种完全依赖 AI 的一种编程方式，这种编程方式下人本身只是用语言输出需求，而 AI 生成实际代码。和之前完全由人编写代码截然不同。因为完全由 AI 生成代码，这就导致代码数量和代码质量其实并不可控。当 AI 生成的代码越来越多时，就会越来越不可控，人已经完全无法理解代码，只能通过观察运行结果不段的让 AI 去修改来达到最终的效果。由此在编码过程中，人只是享受这种编码的氛围而不是在实际的编码。所以叫做氛围编程。</p>
<p>（这样讲，产品经理是不是早就走在氛围编程的前列了😂）</p>
<hr>
<p>vibe coding 得到了许多人的关注和讨论，信奉 AI 编程的人终于找到了归宿，而对 AI 编程不那么执着的人也终于找到一个适合嘲讽的词汇。现在这个阶段，我们既能看到 AI 编程带来的便利：</p>
<ul>
<li>类似 Cursor 这样优秀的工具层出不穷，一直 Tab 和 Apply 就能获得不错的代码反馈；</li>
<li>编码门槛进一步降低，总能听到没有编程经验的人的产品获得巨大成功；</li>
<li>AI 模型质量的不段提高，比如 Claude 3.7，创新变的简单，模型能给你意想不到的效果。</li>
</ul>
<p>也能看到 AI 编程带来的隐患：</p>
<ul>
<li>由于现阶段 AI 能力的不可控，可能更适合一次性的产品，多次迭代可能就意味着引入未知的 bug；</li>
<li>对于真实且特定的线上业务，AI 的或许并不能很好的给出解决方案；</li>
<li>越来越少的人关注代码质量、交付质量，软件工程开始陨落。</li>
</ul>
<hr>
<p>虽然各方对 vibe coding 的讨论各执一词，但现阶段的 AI 编程说到底还是 Copilot 的角色，还是需要一个掌舵人的角色，所以我们要保持清醒，可以享受 AI 编程带来的美妙的 vibe，但切不可沉迷其中无法自拔。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="AI" term="AI"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[【开源推荐】高度简洁的微信 Markdown 编辑器]]></title>
        <id>https://sleepy-zone.github.io/blog/2025-03-19-doocs-md</id>
        <link href="https://sleepy-zone.github.io/blog/2025-03-19-doocs-md"/>
        <updated>2025-03-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[只要你会基本的 Markdown 语法，就能做出一篇样式简洁而又美观大方的微信图文。 这就是今天要推荐的 doocs/md，一款高度简洁的微信 Markdown 编辑器。]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img1@main/2025/03/19/1742380619315-028e1613-5e8a-49a6-a0c6-8828d4df9901.png" alt="" class="img_ev3q"></p>
<p><strong>只要你会基本的 Markdown 语法，就能做出一篇样式简洁而又美观大方的微信图文。</strong> 这就是今天要推荐的 <a href="https://github.com/doocs/md" target="_blank" rel="noopener noreferrer">doocs/md</a>，一款高度简洁的微信 Markdown 编辑器。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="https://sleepy-zone.github.io/blog/2025-03-19-doocs-md#%E7%AE%80%E4%BB%8B" class="hash-link" aria-label="简介的直接链接" title="简介的直接链接">​</a></h2>
<p>项目地址：<a href="https://github.com/doocs/md" target="_blank" rel="noopener noreferrer">https://github.com/doocs/md</a>。</p>
<p>众所周知，微信公众号文章的排版也不是一件简单的事情。在开始写公众号后，一直在找这样的工具，足够简单又足够好看，直到发现了 doocs/md。</p>
<p>并且项目还贴心的为了用户准备了一篇完整的 markdown 的使用文档，即使你以前没用过 markdown 也能快速上手使用。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img2@main/2025/03/19/1742380703439-d54671d0-a934-4bda-a51a-70fecdc45db3.png" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="项目特性">项目特性<a href="https://sleepy-zone.github.io/blog/2025-03-19-doocs-md#%E9%A1%B9%E7%9B%AE%E7%89%B9%E6%80%A7" class="hash-link" aria-label="项目特性的直接链接" title="项目特性的直接链接">​</a></h2>
<ul>
<li>支持 Markdown 所有基础语法、数学公式</li>
<li>提供对 Mermaid 图表的渲染和 GFM 警告块的支持</li>
<li>丰富的代码块高亮主题，提升代码可读性</li>
<li>允许自定义主题色和 CSS 样式，灵活定制展示效果</li>
<li>提供多图上传功能，并可自定义配置图床</li>
<li>便捷的文件导入、导出功能，提升工作效率</li>
<li>内置本地内容管理功能，支持草稿自动保存</li>
</ul>
<p>除这些项目主页的也行外，其实该项目还专门公众号做了一些适配：比如抽取链接转脚注，解决公众号无法展示链接的问题，比如展示阅读时间等等。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="写在后面">写在后面<a href="https://sleepy-zone.github.io/blog/2025-03-19-doocs-md#%E5%86%99%E5%9C%A8%E5%90%8E%E9%9D%A2" class="hash-link" aria-label="写在后面的直接链接" title="写在后面的直接链接">​</a></h2>
<p>总之，很推荐写公众号的同学去使用。</p>
<p>另外，后面我准备基于 doocs/md 做一点工作，将其转换为本地客户端，不仅仅是一款微信编辑器，更是一款简单的本地知识库管理工具。</p>
<p>目前正在开发中：<a href="https://github.com/sleepy-zone/woocs%EF%BC%8C%E6%AC%A2%E8%BF%8E%E5%85%B3%E6%B3%A8%E3%80%82%E6%9C%AC%E6%96%87%E5%B7%B2%E7%BB%8F%E7%94%A8" target="_blank" rel="noopener noreferrer">https://github.com/sleepy-zone/woocs，欢迎关注。本文已经用</a> woocs 编写了！</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img16@main/2025/03/19/1742391696386-1241e101-20cf-49ee-a62e-509f51f7d58f.png" alt="" class="img_ev3q"></p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div>]]></content>
        <author>
            <name>SleepyZone</name>
            <uri>https://github.com/sleepy-zone</uri>
        </author>
        <category label="OpenSource" term="OpenSource"/>
    </entry>
</feed>