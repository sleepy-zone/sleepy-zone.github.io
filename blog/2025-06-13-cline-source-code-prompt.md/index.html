<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Cline 源码浅析 - Prompt 设计 | 😴 Sleepy Zone</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Cline 源码浅析 - Prompt 设计 | 😴 Sleepy Zone"><meta data-rh="true" name="description" content="“Agent 就是如何拼出更好用的 Prompt”，虽然有点玩笑的意味，但也能说明一定的问题。本篇文章我们探讨下 Cline 里的 Prompt 设计。"><meta data-rh="true" property="og:description" content="“Agent 就是如何拼出更好用的 Prompt”，虽然有点玩笑的意味，但也能说明一定的问题。本篇文章我们探讨下 Cline 里的 Prompt 设计。"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-06-13T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/sleepy-zone"><meta data-rh="true" property="article:tag" content="AI,Cline"><link data-rh="true" rel="icon" href="/img/logo.svg"><link data-rh="true" rel="canonical" href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md"><link data-rh="true" rel="alternate" href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md","mainEntityOfPage":"https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md","url":"https://sleepy-zone.github.io/blog/2025-06-13-cline-source-code-prompt.md","headline":"Cline 源码浅析 - Prompt 设计","name":"Cline 源码浅析 - Prompt 设计","description":"“Agent 就是如何拼出更好用的 Prompt”，虽然有点玩笑的意味，但也能说明一定的问题。本篇文章我们探讨下 Cline 里的 Prompt 设计。","datePublished":"2025-06-13T00:00:00.000Z","author":{"@type":"Person","name":"SleepyZone","description":"前端开发 / 开源爱好者","url":"https://github.com/sleepy-zone","image":"https://avatars.githubusercontent.com/u/131369648?v=4"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://sleepy-zone.github.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="😴 Sleepy Zone RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="😴 Sleepy Zone Atom Feed">





<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap">
<script>!function(t,e,n,a,c,r,s){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(r=e.createElement(a)).async=1,r.src="https://www.clarity.ms/tag/r1wmvdsf4a",(s=e.getElementsByTagName(a)[0]).parentNode.insertBefore(r,s)}(window,document,"clarity","script")</script><link rel="stylesheet" href="/assets/css/styles.5d8c36ea.css">
<script src="/assets/js/runtime~main.42b02de1.js" defer="defer"></script>
<script src="/assets/js/main.27ecf4cf.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Sleepy Zone Site Logo" class="themedComponent__dKv themedComponent--light_rzkv"><img src="/img/logo.svg" alt="Sleepy Zone Site Logo" class="themedComponent__dKv themedComponent--dark_mMAk"></div><b class="navbar__title text--truncate">Sleepy Zone</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">🔥博客</a><a class="navbar__item navbar__link" href="/thoughts">💡想法</a><a class="navbar__item navbar__link" href="/weekly/2025-04-23">📚不周刊</a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2025-06-13-cline-source-code-prompt.md">Cline 源码浅析 - Prompt 设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-06-10-cline-source-code-mcp.md">Cline 源码浅析 - MCP 调用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-06-07-cline-source-code-1.md">Cline 源码浅析 - 从输入到输出</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-05-30-cline-rule.md">现在开始使用 Cline Rules</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-04-30-ts-agent-mastra.md">Mastra  - TypeScript AI Agent 框架</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-04-30-deepwiki.md">DeepWiki - 阅读开源代码的神器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-04-24-google-promtps-2.md">谷歌提示词工程 - 最佳实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-04-23-google-promtps.md">谷歌提示词工程 - 模型原理和提示词技术</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-04-21-old-fe-1.md">盘点前端还在更新的老项目</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-04-14-github-no-vistit.md">从 Github 不能访问想到的</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-04-10-what-is-agent.md">什么是 Agent</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-04-07-deepsite.md">DeepSite：基于 DeepSeek 的生码应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-04-06-recent-ai-1.md">最近几件关于 AI 的事情</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-03-28-mcp.md">MCP - AI 和真实世界的桥梁</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-03-26-dev-mcp-server.md">动手开发一个 MCP Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-03-21-woocs">woocs，基于 doocs/md 的微信 Markdown 编辑器桌面应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-03-20-vibe-coding">聊聊 vibe coding</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-03-19-doocs-md">【开源推荐】高度简洁的微信 Markdown 编辑器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-03-17-ai-fomo">AI 浪潮下的 FOMO 情绪</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-03-10-D2">D2 终端技术大会之旅</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-02-25-2025-ai-first">2025 年或许是中国的 AI 元年</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025-02-19-we-are-destroying-software">【好文推荐】我们正在摧毁软件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ai-replace-fe">AI 可以取代前端吗</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/my-2024">迟来的 2024 总结</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/antd-meetup">Ant Design Meetup 之行</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/sketch-plugin-upload">Sketch 插件实现图层导出图片并上传</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ui-diff-in-out">国内外组件库的一些差异</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/thinking-recently">对近期一些事情的看法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/shijing">我读了读诗经</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/gradient-in-fe">聊聊前端里的渐变</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/fabritor-2024-1">fabritor @ 2024 的一些更新</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023-summary">2023 总结</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/welcome">Welcome</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Cline 源码浅析 - Prompt 设计</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-06-13T00:00:00.000Z">2025年6月13日</time> · <!-- -->阅读需 17 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/sleepy-zone" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/131369648?v=4" alt="SleepyZone"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/sleepy-zone" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">SleepyZone</span></a></div><small class="authorTitle_nd0D" title="前端开发 / 开源爱好者">前端开发 / 开源爱好者</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img17@main/2025/06/06/1749176746221-f97aba25-6da5-461a-be21-369de1c44fff.png" alt="" class="img_ev3q"></p>
<p>“Agent 就是如何拼出更好用的 Prompt”，虽然有点玩笑的意味，但也能说明一定的问题。本篇文章我们探讨下 Cline 里的 Prompt 设计。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-prompt">System Prompt<a href="#system-prompt" class="hash-link" aria-label="System Prompt的直接链接" title="System Prompt的直接链接">​</a></h2>
<p>众所周知，System Prompt 是 Agent 的核心  资产😂，Github 上 <a href="https://github.com/x1xhlol/system-prompts-and-models-of-ai-tools" target="_blank" rel="noopener noreferrer">system-prompts-and-models-of-ai-tools</a> 这个仓库收集了各类 AI 应用的 System Prompt，已经有 56.6K 的 Star 了，可见一斑。</p>
<p>Cline 的 System Prompt 位于 <code>src/core/prompts/system.ts</code>，根据上下文信息、工具以及模型信息动态生成。</p>
<blockquote>
<p>You are Cline, a highly skilled software engineer with extensive knowledge in many programming languages, frameworks, design patterns, and best practices.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="工具-tool-use">工具 TOOL USE<a href="#工具-tool-use" class="hash-link" aria-label="工具 TOOL USE的直接链接" title="工具 TOOL USE的直接链接">​</a></h3>
<blockquote>
<p>You have access to a set of tools that are executed upon the user&#x27;s approval. You can use one tool per message, and will receive the result of that tool use in the user&#x27;s response. You use tools step-by-step to accomplish a given task, with each tool use informed by the result of the previous tool use.</p>
</blockquote>
<p>我们自上而下的读一遍 System Prompt。</p>
<ol>
<li>工具调用格式</li>
</ol>
<p>首先告诉模型使用 XML 语法输出工具调用相关的内容。</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">tool_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parameter1_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">value1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parameter1_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">parameter2_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">value2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">parameter2_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">tool_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>工具列表</li>
</ol>
<p>列举了 Cline 内置的工具，主要包括描述、参数以及使用 DEMO，比如 <code>write_to_file</code>：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> write_to_file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description: Request to write content to a file at the specified path. If the file exists, it will be overwritten with the provided content. If the file doesn&#x27;t exist, it will be created. This tool will automatically create any directories needed to write the file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> path: (required) The path of the file to write to (relative to the current working directory ${cwd.toPosix()})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> content: (required) The content to write to the file. ALWAYS provide the COMPLETE intended content of the file, without any truncation or omissions. You MUST include ALL parts of the file, even if they haven&#x27;t been modified.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Usage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">write_to_file</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">path</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">File path here</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">path</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">content</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your file content here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">content</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">write_to_file</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码 到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Cline 内置了十多个工具，覆盖了命令行、文件操作、浏览器、MCP 等，这些工具极大的丰富了模型的能力。</p>
<ol start="3">
<li>工具调用 Example</li>
</ol>
<p>展示了多个工具调用的样例给模型参考：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Tool Use Examples</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Example 1: Requesting to execute a command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">execute_command</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">command</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">npm run dev</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">command</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">requires_approval</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">false</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">requires_approval</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">execute_command</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>工具使用指引</li>
</ol>
<p>这里相当于手把手教模型逐步思考如何使用工具（类似于思维链（CoT）），简单翻译如下：
1）首先，模型需要评估已经掌握的信息，使用 <code>&lt;thinking&gt;</code> 标签包裹。
2）根据任务和提供的工具描述，选择最合适的工具。
3）如果需要执行多个操作，请一次只使用一个工具，每一步都必须以前一步的结果为依据。
4）使用指定的 XML 格式来构建你的工具调用。
5）每次使用工具后，用户将回复该工具的执行结果。这个结果会为你提供继续任务或做出进一步决策所需的信息。
6）每次使用工具后，一定要等待用户的确认后再继续。</p>
<p>以上的操作，可以确保模型按步骤拆解任务，确认每步的成功与否，根据用户的反馈实时进行调整，保证工具使用和最终任务的正确性。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mcp-server">MCP Server<a href="#mcp-server" class="hash-link" aria-label="MCP Server的直接链接" title="MCP Server的直接链接">​</a></h3>
<p>这部分我们在 <a href="https://mp.weixin.qq.com/s?__biz=MzAxMDA0MTE5Mw==&amp;mid=2247483942&amp;idx=1&amp;sn=70ad8830317f688b79d800c39b80a62d&amp;chksm=9b572020ac20a936dcd5606ed29690f3c2d4856b39a0e9193c52f64896d47e4bd064e9e4fc7d&amp;scene=178&amp;cur_album_id=4021745110793502724&amp;search_click_id=#rd" target="_blank" rel="noopener noreferrer">Cline 源码浅析 - MCP 调用</a>聊过，这里不再展开。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="文件编辑-editing-files">文件编辑 EDITING FILES<a href="#文件编辑-editing-files" class="hash-link" aria-label="文件编辑 EDITING FILES的直接链接" title="文件编辑 EDITING FILES的直接链接">​</a></h3>
<p>对于 Code Agent 文件编辑是非常重要的部分，这里再次强调了 <code>write_to_file</code> 和 <code>replace_in_file</code> 两个工具的使用：详细的使用时机以及重要提示。</p>
<p>再次以 workflow 的方式告诉模型使用文件编辑工具的最佳实践：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> 在进行编辑之前，评估你更改的范围，并决定使用哪个工具。  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> 对于有针对性的修改，请使用 </span><span class="token code-snippet code keyword" style="color:#00009f">`replace_in_file`</span><span class="token plain"> 工具，并精心编写 SEARCH/REPLACE 块。如果你需要进行多项更改，可以在一个 </span><span class="token code-snippet code keyword" style="color:#00009f">`replace_in_file`</span><span class="token plain"> 调用中堆叠多个 SEARCH/REPLACE 块。  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">3.</span><span class="token plain"> 对于大规模重构或初始文件创建，请依赖 </span><span class="token code-snippet code keyword" style="color:#00009f">`write_to_file`</span><span class="token plain"> 工具。  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">4.</span><span class="token plain"> 一旦文件 通过 </span><span class="token code-snippet code keyword" style="color:#00009f">`write_to_file`</span><span class="token plain"> 或 </span><span class="token code-snippet code keyword" style="color:#00009f">`replace_in_file`</span><span class="token plain"> 被编辑，系统将向你提供修改后文件的最终状态。请将此更新后的内容作为后续所有 SEARCH/REPLACE 操作的参考点，因为它反映了任何自动格式化或用户手动应用的更改。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">通过在 </span><span class="token code-snippet code keyword" style="color:#00009f">`write_to_file`</span><span class="token plain"> 和 </span><span class="token code-snippet code keyword" style="color:#00009f">`replace_in_file`</span><span class="token plain"> 之间做出深思熟虑的选择，你可以使文件编辑过程更加顺畅、安全和高效。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="act-mode-和-plan-mode">Act Mode 和 Plan Mode<a href="#act-mode-和-plan-mode" class="hash-link" aria-label="Act Mode 和 Plan Mode的直接链接" title="Act Mode 和 Plan Mode的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img17@main/2025/06/11/1749631375428-9af1e1b3-f2d1-44bd-991e-c15f14b7cf96.png" alt="" class="img_ev3q"></p>
<p>Cline 提供了两种模式：Plan 和 Act。对于复杂任务，Cline 推荐从 Plan 模式开始，让模型先行规划策略，然后切换到 Act 模式，按照规划逐步实施，以提高代码输出质量。对话过程中，可以在两个模式中切换，就像人一样，写代码过程中，遇到问题，停下来思考。</p>
<p>System Prompt 里详细描述了两种模式的差异，重点描述了一下 Plan 模式的规则，比如使用 <code>read_file</code> <code>search_files</code> 等工具了解信息，特别推荐使用图表直观展示信息，并强调 Plan 模式下会使用 <code>plan_mode_respond</code> 工具回复信息。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能-capabilities">功能 CAPABILITIES<a href="#功能-capabilities" class="hash-link" aria-label="功能 CAPABILITIES的直接链接" title="功能 CAPABILITIES的直接链接">​</a></h3>
<p>这一大段相当于把上面的工具集进行了一次总结，告诉模型有用哪些能力，可以使用哪些特定工具来完成特定的功能，比如命令行：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">You can use the execute_command tool to run commands on the user&#x27;s computer whenever you feel it can help accomplish the user&#x27;s task. When you need to execute a CLI command, you must provide a clear explanation of what the command does. ......</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="规则-rules">规则 RULES<a href="#规则-rules" class="hash-link" aria-label="规则 RULES的直接链接" title="规则 RULES的直接链接">​</a></h3>
<p>规则部分主要强调了什么可以做，什么不能做。比如不可以使用 ~ 或 $HOME 来表示用户的主目录，不可以使用 cd 命令，不能口语化，必须等待用户确认。这里使用了大量的<code>** **</code> 加粗的标记提醒模型。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="系统信息">系统信息<a href="#系统信息" class="hash-link" aria-label="系统信息的直接链接" title="系统信息的直接链接">​</a></h3>
<p>获取系统信息，这些可以帮助命令行工具、文本读写工具的执行。</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Operating System</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token function" style="color:#d73a49">osName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default Shell</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token function" style="color:#d73a49">getShell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Home Directory</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">homedir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toPosix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current Working Directory</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">cwd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toPosix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="目标">目标<a href="#目标" class="hash-link" aria-label="目标的直接链接" title="目标的直接链接">​</a></h3>
<p>这里奠定了 Cline 处理问题的基调，我完整的贴在这里：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">你通过迭代的方式完成给定的任务，将其分解为清晰的步骤，并有条不紊地逐一执行。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">分析用户的任务</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">，设定明确且可实现的目标以完成它。按逻辑顺序对这些目标进行优先级排序。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> 依次处理这些目标，在必要时一次使用一个可用工具。每个目标应对应你解决问题过程中的一个具体步骤。在整个过程中，你会被告知已完成的工作和剩余的任务。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">3.</span><span class="token plain"> 请记住，你拥有广泛的工具能力，可以灵活、巧妙地运用这些工具来完成每一个目标。在调用任何工具之前，请在 </span><span class="token code-snippet code keyword" style="color:#00009f">`&lt;thinking&gt;&lt;/thinking&gt;`</span><span class="token plain"> 标签中进行分析：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 首先，分析 </span><span class="token code-snippet code keyword" style="color:#00009f">`environment_details`</span><span class="token plain"> 中提供的文件结构，以获取上下文和洞察，从而有效地推进任务。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 然后，思考哪个可用工具最相关，能够帮助你完成用户任务。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 接着，逐个检查该工具所需的参数，并判断用户是否已直接提供或提供了足够的信息用于推断参数值。在决定能否推断某个参数值时，请仔 细考虑所有上下文，看是否支持特定的取值。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 如果所有必需的参数都已存在或可以合理推断，则关闭 </span><span class="token code-snippet code keyword" style="color:#00009f">`&lt;thinking&gt;`</span><span class="token plain"> 标签并继续执行工具操作。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">但如果有一个必需参数的值缺失</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">，</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">不要调用该工具</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">（即使填入占位符也不行），而是使用 </span><span class="token code-snippet code keyword" style="color:#00009f">`ask_followup_question`</span><span class="token plain"> 工具向用户请求缺失的参数。如果未提供的是</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">可选参数</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">，则</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">不要主动询问</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">4.</span><span class="token plain"> 完成用户的任务后，你必须使用 </span><span class="token code-snippet code keyword" style="color:#00009f">`attempt_completion`</span><span class="token plain"> 工具将结果提交给用户。你也可以提供一条 CLI 命令来展示任务的结果；这对于 Web 开发任务尤其有用，例如你可以运行 </span><span class="token code-snippet code keyword" style="color:#00009f">`open index.html`</span><span class="token plain"> 来展示你构建的网站。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">5.</span><span class="token plain"> 用户可能会提供反馈，你可以根据反馈进行改进并重新尝试。但</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">不要陷入无意义的来回对话中</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">，也就是说，</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">不要以问题或提供进一步帮助的提议结束你的回复</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="自定义-system-prompt">自定义 System Prompt<a href="#自定义-system-prompt" class="hash-link" aria-label="自定义 System Prompt的直接链接" title="自定义 System Prompt的直接链接">​</a></h3>
<p>在 <code>addUserInstructions</code> 方法中，追加用户自定义的指令，这里包括了 <a href="https://docs.cline.bot/features/cline-rules" target="_blank" rel="noopener noreferrer">Cline Rules</a>。我们可以在项目根目录下新建 <code>.clinerules/</code> 存放 Cline Rule，Cline 作为 System Prompt 最有效的补充，可以针对不同的项目做不同的定制。</p>
<p>甚至追加了 Cursor 或者 Windsurf 的 Rule。😂</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">localCursorRulesFileInstructions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customInstructions </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> localCursorRulesFileInstructions </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\n\n&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">localCursorRulesDirInstructions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customInstructions </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> localCursorRulesDirInstructions </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\n\n&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">localWindsurfRulesFileInstructions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customInstructions </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> localWindsurfRulesFileInstructions </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\n\n&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="claude4-支持">Claude4 支持<a href="#claude4-支持" class="hash-link" aria-label="Claude4 支持的直接链接" title="Claude4 支持的直接链接">​</a></h3>
<p>Cline 3.17.9 版本对 Claude4 做了特殊支持 <code>src/core/prompts/model_prompts/claude4.ts</code> 以及 <code>src/core/prompts/model_prompts/claude4-experimental.ts</code>。据官方博客描述，在使用新的 Claude4 模型时，会遇到一些编辑错误。</p>
<blockquote>
<p>这次版本更新主要关注 Cline 与 Claude 4 之间的交互，尤其是在搜索和替换操作上。我们调整了分隔符方法，将 &lt; 和 &gt; 替换为 - 和 + ，这在我们的内部测试中显示出了积极的效果，减少了编辑失败，提高了代码修改的成功率。</p>
</blockquote>
<p>这也给我们带来了一些提示：在模型切换时，需要及时的测试和调整 Prompt，以更好的适应更新更强大的模型。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="command-和-workflow">Command 和 Workflow<a href="#command-和-workflow" class="hash-link" aria-label="Command 和 Workflow的直接链接" title="Command 和 Workflow的直接链接">​</a></h2>
<p>除了 Cline Rules，Cline 还提供了其他方式来让用户定制 Prompt。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="slash-command">Slash Command<a href="#slash-command" class="hash-link" aria-label="Slash Command的直接链接" title="Slash Command的直接链接">​</a></h3>
<p>Cline 提供了 Slash Command 的概念，通过 <code>/</code> 触发。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img19@main/2025/06/11/1749635423130-0b111dc0-9024-4a6f-bdab-9ece17bf3e45.png" alt="" class="img_ev3q"></p>
<p>不像 Cline Rule 会针对每个任务生效，Command 在实现特定类型任务的时候很有用。比如我们要反馈 Bug，就可以使用内置的 <code>/reportBug</code> 触发任务。而比如在执行其他任务，比如写代码时，不带上这个命令，也就不会发送相应的提示词给模型。</p>
<p>Command 相应的提示词位于 <code>src/core/prompts/commands.ts</code>，提示词组装过程中，会调用 <code>src/core/slash-commands/index.ts</code> 文件的 <code>parseSlashCommands</code>  方法，将 <code>/</code> 命令替换为指定的提示词。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="workflow">Workflow<a href="#workflow" class="hash-link" aria-label="Workflow的直接链接" title="Workflow的直接链接">​</a></h3>
<p>如果要自定义 Command，除了源码层面定制，Cline 也支持用户手动配置，Cline 称其为 Workflow，Workflow 允许用户自定义步骤来处理特定的任务。在 <code>.clinerules</code> 目录下新建 <code>workflows</code> 目录，目录下新建 markdown 文件，文件内容我处理特定任务的步骤。这时候聊天框中输入 <code>/</code>，就会发现命令列表多了我们定制的 <code>/[workflow-name.md]</code>。</p>
<p>这部分逻辑依然在 <code>parseSlashCommands</code> 方法内，Command 和 Workflow 都会处理成 <code>/</code> 命令。</p>
<p>可以参照 Cline 仓库的 <code>.clinerules/workflows/pr-review.md</code> 编写自己的 Workflow。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mention-">Mention @<a href="#mention-" class="hash-link" aria-label="Mention @的直接链接" title="Mention @的直接链接">​</a></h2>
<p>@ 在 Cline 中是作为引用外部资源扩展上下文存在的。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img11@main/2025/06/11/1749649934154-2a274dec-1ff4-4c14-8e42-4e1a84366bc3.png" alt="" class="img_ev3q"></p>
<p>比如你可以 @ 一个文件路径，那这个文件的内容就会作为 Prompt 带给大模型。格式如下：</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">file_content</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">path</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">path/to/file</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Complete file content]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">file_content</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>除了文件，还可以 @ 问题、命令行甚至是一个 url，不必输入大段文字即可提供给模型更丰富的上下文信息。</p>
<p>mention 相关处理位于 <code>src/core/mentions/index.ts</code>，处理了各种 @ 信息。实践中，我们可以扩展 @能力，比如 @我们内部的知识库来让 Cline 更好的了解团队内部知识。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="memery-bank">Memery Bank<a href="#memery-bank" class="hash-link" aria-label="Memery Bank的直接链接" title="Memery Bank的直接链接">​</a></h2>
<p>Memery Bank 是 Cline Agent 记忆系统的一个解决方案，[Cline Blog] 将 Memery Bank 比喻为笔记本，随着项目的更新持续的更新笔记，这样在开始新任务丢失历史记录和上下文的情况下，Cline 依旧可以通过笔记本里的内容了解项目全貌、技术架构以及当前进度等信息。</p>
<p>我们可以在 <code>.clinerules</code> 目录下新建 <code>memory-bank.md</code>，内容可以参照官方文档给出的<a href="https://docs.cline.bot/prompting/cline-memory-bank" target="_blank" rel="noopener noreferrer">示例</a>。</p>
<p>这份示例要求模型以如下的文档关系整理笔记本：</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img19@main/2025/06/12/1749734819909-17e56603-1947-4c2c-acac-4ec4a589f638.png" alt="" class="img_ev3q"></p>
<p>这六个文件分别作用为：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">projectbrief.md: 项目简介，奠定一切的基础文档</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">productContext.md: 产品上下文，商业和用户视角</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemPatterns.md: 技术架构与决策</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">techContext.md: 开发环境和技术栈</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">activeContext.md: 当前开发状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">progress.md: 项目进度与跟踪</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>实际工作中，工作前需要确认 Memory Bank 文件，获取必要的上下文知识，如果项目有重大更新，则更新相关文档，以应对上下文丢失的情况。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img15@main/2025/06/12/1749735115693-dbaf9940-685d-4e0f-8842-0a56c94c845e.png" alt="" class="img_ev3q"></p>
<p>在 Memory Bank 中，Cline 提倡以 Mermaid 图表作为 Prompt，Cline 团队认为：</p>
<blockquote>
<p>与 AI 交流的最佳方式并非自然语言——而是工作流的结构化语言。</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接">​</a></h2>
<p>Cline 的 Prompt 非常有<strong>模块化</strong>的设计思想。Cline 将 Prompt 划分为 System Prompt、Command、Workflow、Mention、Memery 等模块，System Prompt 则划分为工具、MCP、目标、Mode 等模块，针对全局、特定或者全新的任务使用不同的 Prompt 来解决。</p>
<p>同时我们也发现 Cline 事无巨细，非常“啰嗦”，比如 System Prompt 关于工具调用格式就出现了好几次；尽可能多的提供上下文，这让 Cline 非常的消耗 Token。</p>
<p><img decoding="async" loading="lazy" src="https://fastly.jsdelivr.net/gh/bucketio/img17@main/2025/05/30/1748572666434-e20a0717-a388-47c9-8332-832423e6b337.png" alt="openrouter 网站的统计，Cline 遥遥领先" class="img_ev3q"></p>
<p>如何写出好用的 Prompt，个人感觉主要是两点：</p>
<ol>
<li>足够的上下文和示例（身份、目标、工具、示例等等）</li>
<li>足够详细和明确的执行步骤（Workflow）</li>
</ol>
<p>最后，可以查看官方文档<a href="https://docs.cline.bot/prompting/prompt-engineering-guide" target="_blank" rel="noopener noreferrer">提示词工程指南</a>进一步了解如何为 Cline 写出更好用的 Prompt。</p>
<hr>
<div align="center"><p>欢迎关注我的公众号：前端生存指南，一起聊聊前端、AI 和生活。</p><img src="https://cloud-minapp-47803.cloud.ifanrusercontent.com/1tvAM68Cvrx3bfLR.jpg" style="width:180px"></div></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ai">AI</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cline">Cline</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2025-06-10-cline-source-code-mcp.md"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">Cline 源码浅析 - MCP 调用</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#system-prompt" class="table-of-contents__link toc-highlight">System Prompt</a><ul><li><a href="#工具-tool-use" class="table-of-contents__link toc-highlight">工具 TOOL USE</a></li><li><a href="#mcp-server" class="table-of-contents__link toc-highlight">MCP Server</a></li><li><a href="#文件编辑-editing-files" class="table-of-contents__link toc-highlight">文件编辑 EDITING FILES</a></li><li><a href="#act-mode-和-plan-mode" class="table-of-contents__link toc-highlight">Act Mode 和 Plan Mode</a></li><li><a href="#功能-capabilities" class="table-of-contents__link toc-highlight">功能 CAPABILITIES</a></li><li><a href="#规则-rules" class="table-of-contents__link toc-highlight">规则 RULES</a></li><li><a href="#系统信息" class="table-of-contents__link toc-highlight">系统信息</a></li><li><a href="#目标" class="table-of-contents__link toc-highlight">目标</a></li><li><a href="#自定义-system-prompt" class="table-of-contents__link toc-highlight">自定义 System Prompt</a></li><li><a href="#claude4-支持" class="table-of-contents__link toc-highlight">Claude4 支持</a></li></ul></li><li><a href="#command-和-workflow" class="table-of-contents__link toc-highlight">Command 和 Workflow</a><ul><li><a href="#slash-command" class="table-of-contents__link toc-highlight">Slash Command</a></li><li><a href="#workflow" class="table-of-contents__link toc-highlight">Workflow</a></li></ul></li><li><a href="#mention-" class="table-of-contents__link toc-highlight">Mention @</a></li><li><a href="#memery-bank" class="table-of-contents__link toc-highlight">Memery Bank</a></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></div></div></div></div></div></div>
</body>
</html>